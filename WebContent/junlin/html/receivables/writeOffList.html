<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8" />
		<title>核销单</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../../css/bootstrap.min.css" />
		<link rel="stylesheet" href="../../css/ace.min.css" />
		<link rel="stylesheet" href="../../css/style.css" />
		<link rel="stylesheet" href="../../css/style_i.css" />
		<link rel="stylesheet" href="../../font/css/font-awesome.min.css" />
		<link rel="stylesheet" href="../../js/layer/skin/layer.css" />
		<!--[if IE 7]>
		  <link rel="stylesheet" href="../../font/css/font-awesome-ie7.min.css" />
		  <link rel="stylesheet" href="../../css/ace-ie.min.css" />
		<![endif]-->

		<link rel="stylesheet" href="../../css/mine/all.css" />
		<link rel="stylesheet" href="../../css/mine/public.css" />

		<script src="../../js/jquery-1.10.2.min.js"></script>
		<script src="../../js/bootstrap.min.js"></script>
		<script src="../../js/typeahead-bs2.min.js"></script>
		<script src="../../js/jquery.dataTables.min.js"></script>
		<script src="../../js/jquery.dataTables.bootstrap.js"></script>
		<script src="../../js/layer/layer.js" type="text/javascript"></script>
		<script src="../../js/laydate/laydate.js" type="text/javascript"></script>
		<script src="../../script/public.js" type="text/javascript"></script>

		<style>
			#editDiv,
			#detailDiv {
				padding-top: 20px;
			}
		</style>
	</head>

	<body class="content">
		<div class="page-content clearfix">
			<div id="Member_Ratings">
				<div class="d_Confirm_Order_style" style="margin-top:10px;">
					<h4 class="text-title">核销单</h4>
					<div class="search-div clearfix">
						<div class="clearfix">
							<span class="l_f">
								核销方式： <select>
									<option value="-1">--请选择核销方式--</option>
									<option value="1">预收冲应收</option>
									<option value="2">预付冲应付</option>
									<option value="5">应收冲应付</option>
									<option value="6">应付冲应收</option>
									<!--<option value="3">应付转应付 </option>
									<option value="4">应收转应收</option>
									<option value="7">预收转预收</option>
									<option value="8">预付转预付</option>-->
								</select>
							</span>
							<span class="l_f"> 
								单号： <input type="text" value="" onblur="cky(this)"/>
							</span>
							<span class="l_f"> 
								制单人： <input type="text" value="" onblur="cky(this)"/>
							</span>
							<span class="r_f"> 
								<input type="button"  class="btncss btn_search" value="搜索" />
							</span>
						</div>

					</div>
					<div class="opration-div clearfix">

						<span class="r_f"> 
							<button type="button" class="btncss jl-btn-defult" onclick="prepaidBillAdd()"><i class="fa fa-plus"></i> 新增</button>
						</span>

					</div>
					<div class="table_menu_list">
						<table class="table table-striped table-hover col-xs-12" id="datatable">
							<thead class="table-header">
								<tr>
									<th>单号</th>
									<th>核销方式</th>
									<th>来往单位1</th>
									<th>来往单位2</th>
									<th>当前预收余额</th>
									<th>本次核销金额</th>
									<th>制单人</th>
									<th>日期</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										<span class="look-span" onclick="billDetail1()">PO.2017.09.00054</span>
									</td>
									<td>预收冲应收</td>
									<td>1111</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>
										<input type="button" class="btncss edit" onclick="billDetail1()" value="详情" />
									</td>
								</tr>
								<tr>
									<td>
										<span class="look-span" onclick="billDetail2()">PO.2017.09.00054</span>
									</td>
									<td>预付冲应付</td>
									<td>1111</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>
										<input type="button" class="btncss edit" onclick="billDetail2()" value="详情" />
									</td>
								</tr>
								<tr>
									<td>
										<span class="look-span" onclick="billDetail56()">PO.2017.09.00054</span>
									</td>
									<td>应收冲应付</td>
									<td>1111</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>#####</td>
									<td>
										<input type="button" class="btncss edit" onclick="billDetail56()" value="详情" />
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!--新增 (核销方式：预收冲应收，预付冲应付 )-->
		<div id="verificationMethod12" style="display: none;">
			<form class="container">
				<div class="row jl-title">
					<span>基本信息</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">核销方式</label>
								<div class="col-xs-8">
									<select class="form-control" disabled="disabled" id="verificationMethod_add12">
										<option value="-1">--请选择核销方式--</option>
										<option value="1">预收冲应收</option>
										<option value="2">预付冲应付</option>
										<option value="3">应付转应付 </option>
										<option value="4">应收转应收</option>
										<option value="5">应收冲应付</option>
										<option value="6">应付冲应收</option>
										<option value="7">预收转预收</option>
										<option value="8">预付转预付</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label intercourseUnit1">预收客户</label>
								<div class="col-xs-8">
									<select class="form-control" id="AdvanceIntercourseUnit1" onchange="amountAdvance(this)">
										<option value="-1">--请选择往来单位--</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label intercourseUnit2">应收客户</label>
								<div class="col-xs-8">
									<select class="form-control" id="AdvanceIntercourseUnit2" onchange="orderChange(this,'bill')">
										<option value="-1">--请选择往来单位--</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">当前预收余额</label>
								<div class="col-xs-8">
									<input type="text" id="balance" class="form-control" value="" disabled="disabled" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">币种</label>
								<div class="col-xs-8">
									<input type="text" id="currency" class="form-control" value="人民币" disabled="disabled" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">汇率</label>
								<div class="col-xs-8">
									<input type="text" id="exchangeRate" class="form-control" value="1" disabled="disabled" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">凭证号</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" onblur="cky(this)" />
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row jl-title">
					<span>单据引用</span>
					<i class="r_f"> 
						<button type="button" class="btncss jl-btn-importent" onclick="documentReference('AdvanceIntercourseUnit2')">引用单据</button>
					</i>
					<i class="r_f">
					<select id="bill" disabled="disabled">
						<option value="-1">--请选择单据--</option>
						<option value="123" attr-date="date" attr-money="1000" attr-alreadyPrice="100">44</option>
					</select>
					</i>
				</div>
				<div class="row">
					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tbody id="billTbody">
							<tr>
								<th>单据编号</th>
								<th>单据日期</th>
								<th>总金额</th>
								<th>已结算金额</th>
								<th>未结算金额</th>
								<th>本次核销</th>
								<th>核销</th>
								<th>备注</th>
								<th>操作</th>
							</tr>
							<tr class="tipTr">
								<td colspan="9">请先选择单据</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="row jl-title">
					<span>合计</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">本次核销总金额</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" name="" id="totalAmount" value="" disabled="disabled" />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row jl-title">
					<span>其他</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">部门</label>
								<div class="col-xs-8">
									<select class="form-control">
										<option value="-1">--请选择部门--</option>
										<option value="1">部门</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">摘要</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" name="" id="" value="" onblur="cky(this)" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">分支机构</label>
								<div class="col-xs-8">
									<select class="form-control">
										<option value="-1">--请选择分支机构--</option>
										<option value="1">总部</option>
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>

			</form>

		</div>

		<!--新增 (核销方式：应收冲应付，应付冲应收) -->
		<div id="verificationMethod56" style="display: none;">
			<form class="container">
				<div class="row jl-title">
					<span>基本信息</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">核销方式</label>
								<div class="col-xs-8">
									<select class="form-control" disabled="disabled" id="verificationMethod_add56">
										<option value="-1">--请选择核销方式--</option>
										<option value="1">预收冲应收</option>
										<option value="2">预付冲应付</option>
										<option value="3">应付转应付 </option>
										<option value="4">应收转应收</option>
										<option value="5">应收冲应付</option>
										<option value="6">应付冲应收</option>
										<option value="7">预收转预收</option>
										<option value="8">预付转预付</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">客户</label>
								<div class="col-xs-8">
									<select class="form-control" id="customer" onchange="orderChange(this,'customerBill')">
										<option value="-1">--请选择客户--</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">供应商</label>
								<div class="col-xs-8">
									<select class="form-control" id="supplier" onchange="orderChange(this,'supplierBill')">
										<option value="-1">--请选择供应商--</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">凭证号</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" onblur="cky(this)" />
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row jl-title">
					<span>客户单据引用</span>
					<i class="r_f"> 
						<button type="button" class="btncss jl-btn-importent" onclick="documentReference('customer')">引用单据</button>
					</i>
					<i class="r_f">
					<select id="customerBill" disabled="disabled">
						<option value="-1">--请选择单据--</option>
						<option value="123" attr-date="date" attr-money="1000" attr-alreadyPrice="100">44</option>
					</select>
					</i>
				</div>
				<div class="row">
					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tbody id="customerBillTbody">
							<tr>
								<th>单据编号</th>
								<th>单据日期</th>
								<th>总金额</th>
								<th>已结算金额</th>
								<th>未结算金额</th>
								<th>本次核销</th>
								<th>核销</th>
								<th>备注</th>
								<th>操作</th>
							</tr>
							<tr class="tipTr">
								<td colspan="9">请先选择单据</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="row jl-title">
					<span>供应商单据引用</span>
					<i class="r_f"> 
						<button type="button" class="btncss jl-btn-importent" onclick="documentReference('supplier')">引用单据</button>
					</i>
					<i class="r_f">
					<select id="supplierBill" disabled="disabled">
						<option value="-1">--请选择单据--</option>
						<option value="123" attr-date="date" attr-money="1000" attr-alreadyPrice="100">44</option>
					</select>
					</i>
				</div>
				<div class="row">
					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tbody id="supplierBillTbody">
							<tr>
								<th>单据编号</th>
								<th>单据日期</th>
								<th>总金额</th>
								<th>已结算金额</th>
								<th>未结算金额</th>
								<th>本次核销</th>
								<th>核销</th>
								<th>备注</th>
								<th>操作</th>
							</tr>
							<tr class="tipTr">
								<td colspan="9">请先选择单据</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="row jl-title">
					<span>合计</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">客户核销总金额</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" name="" id="customerTotalAmount" value="" disabled="disabled" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">供应商核销总金额</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" name="" id="supplierTotalAmount" value="" disabled="disabled" />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row jl-title">
					<span>其他</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">部门</label>
								<div class="col-xs-8">
									<select class="form-control">
										<option value="-1">--请选择部门--</option>
										<option value="1">部门</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">摘要</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" name="" id="" value="" onblur="cky(this)" />
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">分支机构</label>
								<div class="col-xs-8">
									<select class="form-control">
										<option value="-1">--请选择分支机构--</option>
										<option value="1">总部</option>
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>

			</form>

		</div>
		
			
		<!--详情 (核销方式：预收冲应收，预付冲应付 )-->
		<div id="verificationMethod12Detail" style="display: none;">
			<form class="container">
				<div class="row jl-title">
					<span>基本信息</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">日期：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">订单号：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">核销方式：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label intercourseUnit1">预收客户：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label intercourseUnit2">应收客户：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">当前预收余额：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">币种：</label>
								<div class="col-xs-8">
									人民币
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">汇率：</label>
								<div class="col-xs-8">
									1
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">凭证号：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row jl-title">
					<span>单据引用</span>
				</div>
				<div class="row">
					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tbody id="billTbody">
							<tr>
								<th>单据编号</th>
								<th>单据日期</th>
								<th>总金额</th>
								<th>已结算金额</th>
								<th>未结算金额</th>
								<th>本次核销</th>
								<th>核销</th>
								<th>备注</th>
								<th>操作</th>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="row jl-title">
					<span>合计</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">本次核销总金额：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row jl-title">
					<span>其他</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">部门：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">制单人：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">摘要：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">分支机构：</label>
								<div class="col-xs-8">
								</div>
							</div>
						</div>
					</div>
				</div>

			</form>

		</div>
		
		<!--详情 (核销方式：应收冲应付，应付冲应收) -->
		<div id="verificationMethod56Detail" style="display: none;">
			<form class="container">
				<div class="row jl-title">
					<span>基本信息</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">核销方式：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">客户：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">供应商：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">凭证号：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row jl-title">
					<span>客户单据引用</span>
					
				</div>
				<div class="row">
					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tbody>
							<tr>
								<th>单据编号</th>
								<th>单据日期</th>
								<th>总金额</th>
								<th>已结算金额</th>
								<th>未结算金额</th>
								<th>本次核销</th>
								<th>核销</th>
								<th>备注</th>
								<th>操作</th>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="row jl-title">
					<span>供应商单据引用</span>
					
				</div>
				<div class="row">
					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tbody >
							<tr>
								<th>单据编号</th>
								<th>单据日期</th>
								<th>总金额</th>
								<th>已结算金额</th>
								<th>未结算金额</th>
								<th>本次核销</th>
								<th>核销</th>
								<th>备注</th>
								<th>操作</th>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="row jl-title">
					<span>合计</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">客户核销总金额：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">供应商核销总金额：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row jl-title">
					<span>其他</span>
				</div>
				<div class="jl-panel">
					<div class="row">
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">部门：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">摘要：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
						<div class="col-md-6 col-xs-6">
							<div class="form-group">
								<label for="" class="col-xs-4 control-label">分支机构：</label>
								<div class="col-xs-8">
									
								</div>
							</div>
						</div>
					</div>
				</div>

			</form>

		</div>
		
		
		<div id="verificationMethodDiv" style="display: none;margin-top: 30px;">
			<div class="row">
				<div class="col-md-12 col-xs-12">
					<div class="form-group">
						<label for="" class="col-xs-3 control-label">核销方式</label>
						<div class="col-xs-8">
							<select class="form-control" id="verificationMethod">
								<option value="-1">--请选择核销方式--</option>
								<option value="1">预收冲应收</option>
								<option value="2">预付冲应付</option>
								<option value="5">应收冲应付</option>
								<option value="6">应付冲应收</option>
								<!--<option value="3">应付转应付 </option>
								<option value="4">应收转应收</option>
								<option value="7">预收转预收</option>
								<option value="8">预付转预付</option>-->
							</select>
						</div>
					</div>
				</div>
			</div>

		</div>

	</body>

	<script>
		var billsArr = [];
		$(function() {
			/*请在此处添加页面内下拉框的option添加事件*/

		})

		/*新增*/
		function prepaidBillAdd() {
			layer.open({
				type: 1,
				title: "核销方式",
				closeBtn: 1,
				area: ['500px', '200px'],
				content: $("#verificationMethodDiv"),
				btn: ['确定'],
				yes: function(index) {
					var verificationMethodVal = $("#verificationMethod").val();
					switch(verificationMethodVal) {
						case "-1":
							layfail("请先选择核销方式");
							break;
						case "1":
							/*预收冲应收*/
							layer.close(index);
							$("#verificationMethod_add12").val(1);
							$("#verificationMethod12 .intercourseUnit1").html("预收客户");
							$("#verificationMethod12 .intercourseUnit2").html("应收客户");
							$("#balance").attr("placeholder", "请先选择预收客户");

							$("#AdvanceIntercourseUnit1").html('<option value="-1" attr-amountAdvance="">--请选择预收客户--</option>');
							/*请在后台查找到有预付金额的客户，并在此处向AdvanceIntercourseUnit1添加option*/
							$("#AdvanceIntercourseUnit1").append('<option value="1" attr-amountAdvance="10000">客户1</option>');

							$("#AdvanceIntercourseUnit2").html('<option value="-1">--请选择应收客户--</option>');
							/*请在后台查找到拥有未核销订单的客户，并在此处向AdvanceIntercourseUnit2添加option*/
							$("#AdvanceIntercourseUnit2").append('<option value="1">客户1</option>');

							openLayer("verificationMethod12", function(openLayerIndex) {
								if(amountAllowable()) {
									/*
									 * 请在此处撰写提交表单代码
									 */
									layer.close(openLayerIndex);
									laysuccess("已核销")
								}
							})

							break;
						case "2":
							/*预付冲应付*/
							layer.close(index);
							$("#verificationMethod_add12").val(2);
							$("#verificationMethod12 .intercourseUnit1").html("预付供应商");
							$("#verificationMethod12 .intercourseUnit2").html("应付供应商");
							$("#balance").attr("placeholder", "请先选择预付供应商");

							$("#AdvanceIntercourseUnit1").html('<option value="-1" attr-amountAdvance="">--请选择预付供应商--</option>');
							/*请在后台查找到有预付金额的供应商，并在此处向AdvanceIntercourseUnit1添加option*/
							$("#AdvanceIntercourseUnit1").append('<option value="1" attr-amountAdvance="10000">供应商1</option>');

							$("#AdvanceIntercourseUnit2").html('<option value="-1">--请选择应付供应商--</option>');
							/*请在后台查找到拥有未核销订单的供应商，并在此处向AdvanceIntercourseUnit2添加option*/
							$("#AdvanceIntercourseUnit2").append('<option value="1">供应商1</option>');

							openLayer("verificationMethod12", function(openLayerIndex) {
								if(amountAllowable()) {
									/*
									 * 请在此处撰写提交表单代码
									 */
									layer.close(openLayerIndex);
									laysuccess("已核销")
								}

							})
							break;
						case "5":
							/*应收冲应付*/
							layer.close(index);
							$("#verificationMethod_add56").val(5);
							$("#customer").html('<option value="-1">--请选择客户--</option>');
							/*请在后台查找到有未核销销售订单的客户，并在此处向customer添加option*/
							$("#customer").append('<option value="1">客户1</option>');

							$("#supplier").html('<option value="-1">--请选择供应商--</option>');
							/*请在后台查找到有未核销采购订单的供应商，并在此处向supplier添加option*/
							$("#supplier").append('<option value="1">供应商1</option>');

							openLayer("verificationMethod56", function(openLayerIndex) {
								if(amountAllowableCustomerSupplier()) {
									/*
									 * 请在此处撰写提交表单代码
									 */
									layer.close(openLayerIndex);
									laysuccess("已核销")
								}
							})

							break;
						case "6":
							/*应付冲应收*/
							layer.close(index);
							$("#verificationMethod_add56").val(6);
							$("#customer").html('<option value="-1">--请选择客户--</option>');
							/*请在后台查找到有未核销销售订单的客户，并在此处向customer添加option*/
							$("#customer").append('<option value="1">客户1</option>');

							$("#supplier").html('<option value="-1">--请选择供应商--</option>');
							/*请在后台查找到有未核销采购订单的供应商，并在此处向supplier添加option*/
							$("#supplier").append('<option value="1">供应商1</option>');

							openLayer("verificationMethod56", function(openLayerIndex) {
								if(amountAllowableCustomerSupplier()) {
									/*
									 * 请在此处撰写提交表单代码
									 */
									layer.close(openLayerIndex);
									laysuccess("已核销")
								}

							})

							break;

					}

				},
				end: function() {
					clearForm("verificationMethodDiv");
				}

			});

		}

		/*
		 * 计算金额是否允许提交（type:1,2）
		 * 本次核销单据的金额总和小于零或大于预收/预付金额*/
		function amountAllowable() {
			var totalAmount = $("#totalAmount").val() - 0;
			var balance = $("#balance").val() - 0;
			if(totalAmount > balance || totalAmount <= 0) {
				MessageLayer("冲销金额不能小于零或大于余额", function() {})
				return false;
			} else {
				return true;
			}
		}
		/*
		 * 计算金额是否允许提交（type:5,6）
		 * 采购和销售相等*/
		function amountAllowableCustomerSupplier() {
			
			var customerTotalAmount = $("#customerTotalAmount").val() - 0;
			var supplierTotalAmount = $("#supplierTotalAmount").val() - 0;
			console.log("supplierTotalAmount"+supplierTotalAmount+"customerTotalAmount"+customerTotalAmount);
			if(customerTotalAmount != supplierTotalAmount) {
				MessageLayer("客户核销金额与供应商核销金额不相等！", function() {});
				return false;
			} else {
				return true;
			}
		}

		/*预收客户/供应商的改变事件*/
		function amountAdvance(thisSelect) {
			var amountAdvance = $("#AdvanceIntercourseUnit1 option:selected").attr("attr-amountAdvance");
			$("#balance").val(amountAdvance);
		}

		/*创建一个通用的打开新增核销单的layer的方法*/
		function openLayer(layerId, callFun) {
			layer.open({
				type: 1,
				title: "新增核销单",
				closeBtn: 1,
				area: ['100%', '100%'],
				content: $("#" + layerId + ""),
				btn: ['提交', '取消'],
				yes: function(openLayerIndex) {
					if(!checkFormHaveEmpty(layerId)) {
						callFun(openLayerIndex);
					}

				},
				end: function(index, layero) {
					layer.close(index);
					clearForm(layerId, "");
					clearBill();
					$("#currency").val("人民币");
					$("#exchangeRate").val("1");
				}
			});
		}

		/*判断单据是否为空*/
		function checkFormHaveEmpty(DivId) {
			if(!isnotEmpty($("#" + DivId + " .jl-panel input").val() + "") || $("#" + DivId + " .jl-panel select").val() == "-1" || !isnotEmpty($("#" + DivId + " .table input").val() + "")||$("#" + DivId + " .table select").val()=="-1" || $("#" + DivId + " .tipTr").length > 0) {
				layfail("表单未填完整，请完善后再提交！")
				return true;
			} else {
				return false;
			}
		}

		/*单据引用*/
		function documentReference(AdvanceIntercourseUnitId) {
			/*确定下拉菜单*/
			let selectid = "bill";
			let tbody = "billTbody";
			let totalAmountId="totalAmount";
			if(AdvanceIntercourseUnitId == "customer") {
				selectid = "customerBill";
				tbody = "customerBillTbody";
				totalAmountId="customerTotalAmount";
			} else if(AdvanceIntercourseUnitId == "supplier") {
				selectid = "supplierBill";
				tbody = "supplierBillTbody";
				totalAmountId="supplierTotalAmount";
			}
			
			/*获取订单相关值*/
			let documentNum = $("#"+selectid).val();
			let datetime = $("#"+selectid+" option:selected").attr("attr-date");
			let price = $("#"+selectid+" option:selected").attr("attr-money");
			let alreadyPrice = $("#"+selectid+" option:selected").attr("attr-alreadyPrice");
			
			/*判断并添加到table*/
			if($("#" + AdvanceIntercourseUnitId).val() == "-1") {
				if(AdvanceIntercourseUnitId == "AdvanceIntercourseUnit2") {
					layfail("请先选择" + $("#verificationMethod12 .intercourseUnit2").html() + "!");
				} else if(AdvanceIntercourseUnitId == "customer") {
					layfail("请先选择客户!");
				} else if(AdvanceIntercourseUnitId == "supplier") {
					layfail("请先选择供应商!");
				}
			} else if(documentNum == -1) {
				layfail("请先选择单据!");
			} else if(!checkRepeat(documentNum, billsArr)) {
				$("#"+tbody+" .tipTr").remove();
				billsArr.push(documentNum);
				$("#"+tbody).append('<tr><td class="documentNum">' + documentNum + '</td><td>' + datetime + '</td><td>' + price +
					'</td><td>' + alreadyPrice + '</td><td class="unsettledAmount">' + (price - alreadyPrice) + '</td>' +
					'<td><input type="text" class="form-control amountPayment" onkeyup="amountPaymentOnKeyUp(this,\''+totalAmountId+'\')" /></td>' +
					'<td><select class="form-control"><option value="-1">是否核销</option><option value="1">是</option><option value="2">否</option></select></td>' +
					'<td><input type="text" class="form-control" onblur="cky(this)" /></td>' +
					'<td><input type="button" class="btncss edit" onclick="billDel(this)" value="删除" /></td></tr>');
			} else {
				layfail("请勿重复选择单据！");
			}
		}

		/*删除单据*/
		function billDel(thisbtn) {
			let $tbody=$(thisbtn).parents("tbody");
			let documentNum = $(thisbtn).parents("tr").find(".documentNum").html();
			billsArr.remove(documentNum);
			$(thisbtn).parents("tr").remove();
			if($tbody.find("tr").length == 1) {
				$tbody.append('<tr class="tipTr"><td colspan="9">请先选择单据</td></tr>');
			}
			let totalAmountId="totalAmount";
			if($tbody.attr("id") == "customerBillTbody") {
				totalAmountId="customerTotalAmount";
			} else if($tbody.attr("id") == "supplierBillTbody") {
				totalAmountId="supplierTotalAmount";
			}
			countTotalAmount(totalAmountId);
		}

		/*单据查重*/
		function checkRepeat(id, billsArr) {
			let flag = false;
			for(var i in billsArr) {
				if(billsArr[i] == id) {
					flag = true;
				}
			}
			return flag;
		}
		

		/*清空单据*/
		function clearBill() {
			$("#billTbody,#customerBillTbody,#supplierBillTbody").html('<tr><th>单据编号</th><th>单据日期</th><th>总金额</th><th>已结算金额</th><th>未结算金额</th><th>本次核销</th><th>核销</th><th>备注</th><th>操作</th></tr>' +
				'<tr class="tipTr"><td colspan="9">请先选择单据</td></tr>');
			billsArr = [];
		}

		/*应收客户/供应商的change事件(类型：1，2)*/
		function orderChange(thisSelect, billId) {
			clearBill();
			if($(thisSelect).val() == "-1") {
				$('#' + billId + '').parent().html('<select id="' + billId + '"  disabled="disabled"><option value="-1">--请选择单据--</option></select>');
			} else {
				$('#' + billId + '').attr("disabled", false);
				$('#' + billId + '').parent().html('<select id="' + billId + '" ><option value="-1">--请选择单据--</option></select>');

				/*请在此处为单据下拉框赋值*/
				$('#' + billId + '').append('<option value="44" attr-date="date" attr-money="1000" attr-alreadyPrice="100">44</option>')
				$('#' + billId + '').append('<option value="22" attr-date="date" attr-money="10000" attr-alreadyPrice="1000">22</option>')
			}
		}

		/*本次核销的onkeyup事件*/
		function amountPaymentOnKeyUp(thisInput,totalAmountId) {
			pressMoney(thisInput);

			if($(thisInput).val() != "") {
				let parentTr = $(thisInput).parents("tr");
				let unsettledAmount = parentTr.find(".unsettledAmount").html() - 0;
				let amountPayment = $(thisInput).val() - 0;
				if(amountPayment == 0) {
					layfail("本次核销金额不能为0！");
					$(thisInput).val("");
				} else if(unsettledAmount < amountPayment) {
					layfail("本次核销金额不能大于未结算金额！");
					$(thisInput).val("");
				}
			}
			countTotalAmount(totalAmountId);

		}

		/*计算总金额*/
		function countTotalAmount(totalAmountId) {
			let tbody = "billTbody";
			if(totalAmountId == "customerTotalAmount") {
				tbody = "customerBillTbody";
			} else if(totalAmountId == "supplierTotalAmount") {
				tbody = "supplierBillTbody";
			}
			let totalAmount = 0;
			$("#"+tbody+" .amountPayment").each(function(index, obj) {
				if($(obj).val() != "") {
					totalAmount += ($(obj).val() - 0);
				}
			})
			let $totalAmountInput=$("#"+totalAmountId);
			$totalAmountInput.val(totalAmount);
		}

		/*详情(类型：1预收冲应收)*/
		function billDetail1() {
			$("#verificationMethod12Detail .intercourseUnit1").html("预收客户：");
			$("#verificationMethod12Detail .intercourseUnit2").html("应收客户：");
			/*
			 * 请在此处添加详情的赋值代码
			 * 注释：billDetail1()和billDetail2()两方法引用的是同一个Div所以你可以写一个方法在这两个方法内调用
			 */
			
			openLayerDetail("verificationMethod12Detail");
		}
		/*详情 (类型：2预付冲应付)*/
		function billDetail2() {
			$("#verificationMethod12Detail .intercourseUnit1").html("预付供应商：");
			$("#verificationMethod12Detail .intercourseUnit2").html("应付供应商：");
			/*
			 * 请在此处添加详情的赋值代码
			 * 注释：billDetail1()和billDetail2()两方法引用的是同一个Div所以你可以写一个方法在这两个方法内调用
			 */
			
			openLayerDetail("verificationMethod12Detail");
		}
		/*详情(类型：5应收冲应付、6应付冲应收)*/
		function billDetail56() {
			/*
			 * 请在此处添加详情的赋值代码
			 */
			openLayerDetail("verificationMethod56Detail");
			
		}
		/*添加一个详情共同引用的layer方法*/
		function openLayerDetail(layerid){
			layer.open({
				type: 1,
				title: "核销单详情",
				closeBtn: 1,
				area: ['100%', '100%'],
				content: $("#"+layerid+""),
				btn: ['关闭'],
			});
		}
	</script>

</html>