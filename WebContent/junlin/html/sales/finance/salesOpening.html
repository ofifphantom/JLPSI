<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8" />
		<title>销售开单</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../../../css/bootstrap.min.css" />
		<link rel="stylesheet" href="../../../css/ace.min.css" />
		<link rel="stylesheet" href="../../../css/style.css" />
		<link rel="stylesheet" href="../../../css/style_i.css" />
		<link rel="stylesheet" href="../../../font/css/font-awesome.min.css" />
		<link rel="stylesheet" href="../../../js/layer/skin/layer.css" />
		<!--[if IE 7]>
		  <link rel="stylesheet" href="../../../font/css/font-awesome-ie7.min.css" />
		  <link rel="stylesheet" href="../../../css/ace-ie.min.css" />
		<![endif]-->

		<link rel="stylesheet" href="../../../css/mine/all.css" />
		<link rel="stylesheet" href="../../../css/mine/public.css" />

		<script src="../../../js/jquery-1.10.2.min.js"></script>
		<script src="../../../js/bootstrap.min.js"></script>
		<script src="../../../js/typeahead-bs2.min.js"></script>
		<script src="../../../js/jquery.dataTables.min.js"></script>
		<script src="../../../js/jquery.dataTables.bootstrap.js"></script>
		<script src="../../../js/layer/layer.js" type="text/javascript"></script>
		<script src="../../../js/laydate/laydate.js" type="text/javascript"></script>
		<script src="../../../script/public.js" type="text/javascript"></script>

		<style>
			#editDiv {
				padding-top: 20px;
			}
			#foldlossDiv{
				margin:50px auto;
			}
			#foldlossDiv table th {
				text-align: center;
			}
			.jl-panel{
				padding: 30px;
			}
			#foldlossDiv .jl-panel{
				position: relative;
			}
			.jl-title .r_f{
				margin-top: 15px;
			}
		</style>
	</head>

	<body class="content">
		<div class="page-content clearfix">
			<div id="Member_Ratings">
				<div class="d_Confirm_Order_style" style="margin-top:10px;">
					<h4 class="text-title">销售开单</h4>
					<div class="search-div clearfix">
						<div class="clearfix">
							<span class="l_f"> 
							单号： <input type="text" value="" />
						</span>
							<span class="l_f"> 
							客户： <input type="text" value="" />
						</span>
							<span class="l_f"> 
							货品名称： <input type="text"  value="" />
						</span>

							</span>
							<span class="r_f"> 
							<input type="button"  class="btncss btn_search" value="搜索" />
						</span>
						</div>

					</div>
					<div class="opration-div clearfix">

					</div>
					<div class="table_menu_list">
						<table class="table table-striped table-hover col-xs-12" id="datatable">
							<thead class="table-header">
								<tr>
									<th>单号</th>
									<th>客户</th>
									<th>运输方式</th>
									<th>货品编码</th>
									<th>货品名称</th>
									<th>部门</th>
									<th>制单人</th>
									<th>审核人</th>
									<th>日期</th>
									<th>状态</th>
									<th width="21%">操作</th>
								</tr>

							</thead>
							<tbody>
								<tr>
									<td>
										<span class="look-span" onclick="salesOpeningDetail()">PO.2017.09.00054</span>
									</td>
									<td>通泰十八里店</td>
									<td>配送</td>
									<td>212454878</td>
									<td>酱肉包</td>
									<td>A部门</td>
									<td>小辉</td>
									<td>小辉</td>
									<td>2017.10.02</td>
									<td>已完成</td>
									<td>
										<input type="button" class="btncss edit" onclick="salesOpeningDetail()" value="详情" />
										<input type="button" class="btncss edit" onclick="salesOpeningAudit()" value="申请修改" />
									</td>
								</tr>
								<tr>
									<td>
										<span class="look-span" onclick="salesOpeningDetail()">PO.2017.09.00054</span>
									</td>
									<td>通泰十八里店</td>
									<td>配送</td>
									<td>212454878</td>
									<td>酱肉包</td>
									<td>A部门</td>
									<td>小辉</td>
									<td>小辉</td>
									<td>2017.10.02</td>
									<td>已完成</td>
									<td>
										<input type="button" class="btncss edit" onclick="salesOpeningDetail()" value="详情" />
										
										<input type="button" class="btncss edit" onclick="salesOpeningModify()" value="修改" />
									</td>
								</tr>
								<tr>
									<td>
										<span class="look-span" onclick="salesOpeningDetail()">
											PO.2017.09.00054</span>
									</td>
									<td>通泰十八里店</td>
									<td>配送</td>
									<td>212454878</td>
									<td>酱肉包</td>
									<td>A部门</td>
									<td>小辉</td>
									<td>小辉</td>
									<td>2017.10.02</td>
									<td>已完成</td>
									<td>
										<input type="button" class="btncss edit" onclick="salesOpeningDetail()" value="详情" />
										<input type="button" class="btncss edit" disabled="disabled" value="审核中" />
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!--详情 -->
		<div id="lookDiv" style="display: none;">
			<form class="container">
				<div class="row jl-title">
					<span>基本信息</span>
				</div>
				<div class="row jl-panel">
					<div class="col-xs-6">
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">日期：</label>
							<div class="col-xs-8">
								2017-9-5
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">客户编码：</label>
							<div class="col-xs-8">
								AAAAA
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">结算方式：</label>
							<div class="col-xs-8">
								月结
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">发货时间：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">运输方式：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">联系电话：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">订货人：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
					</div>
					<div class="col-xs-6">
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">单号：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>

						<div class="form-group">
							<label for="" class="col-xs-4 control-label">客户：</label>
							<div class="col-xs-8">
								通泰十八里店
							</div>
						</div>

						<div class="form-group">
							<label for="" class="col-xs-4 control-label">有效期至：</label>
							<div class="col-xs-8">
								铁路
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">发货地点：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">收货人：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">传真：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">预收金额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
					</div>
				</div>
				<div class="row jl-title">
					<span>商品</span>
				</div>
				<div class="row jl-panel">
					<div class="col-xs-6">
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">货品编码：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">规格：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">发货数量：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">签收数量：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">单价：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">税额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">折损金额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">批号：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">备注：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>

					</div>
					<div class="col-xs-6">
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">货品名称：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">规格编码：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">单位：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">返货数量：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">折扣%：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">税率：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">金额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">签收金额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">赠品：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>

					</div>
				</div>

				<div class="row jl-title">
					<span>合计</span>
				</div>
				<div class="row jl-panel">
					<div class="col-xs-6">
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">发货数量：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">税额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">折损金额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
					</div>
					<div class="col-xs-6">
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">返货数量：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">金额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">签收金额：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
					</div>
				</div>
				<div class="row jl-title">
					<span>其他</span>
				</div>
				<div class="row jl-panel">
					<div class="col-xs-6">
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">地区：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">业务员：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">审核人：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">分支机构：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
					</div>
					<div class="col-xs-6">
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">部门：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">制单人：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
						<div class="form-group">
							<label for="" class="col-xs-4 control-label">摘要：</label>
							<div class="col-xs-8">
								123456
							</div>
						</div>
					</div>
				</div>

			</form>

		</div>
		
		
		<div id="foldlossDiv" style="display: none;">
			<form action="" class="container">
				<div class="row jl-title">
					<span>折损单</span>
					<i>
						<input type="button" class="btncss jl-btn-importent" id="foldLossBtn"  value="新增折损单" onclick="foldLossAdd(this)">
					</i>
					<i class="r_f">
					</i>
				</div>
				<!--<div class="row jl-panel">
					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tr>
							<th>折损商品</th><th>单价</th><th>折损数量</th><th>折损金额</th>
						</tr>
						
						<tr>
							<td>虾条</td>
							<td>10</td>
							<td><input type="text" class="form-control"  value=""/></td>
							<td><input type="text" class="form-control"  value=""/></td>
						</tr>
					</table>
					<div class="col-xs-12 text-center">
						<input type="button" class="btncss jl-btn-warm" onclick="" value="提交">
					</div>
				</div>-->
				
				<div class="row jl-title">
					<span>返货单</span>
					<i>
						<input type="button" class="btncss jl-btn-importent" id="returnListBtn"  value="新增返货单" onclick="returnListAdd(this)">
					</i>
					<i class="r_f">
					</i>	
				</div>
				<!--<div class="row jl-panel">
					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tr>
							<th>折损商品</th><th>返货数量</th>
						</tr>
						
						<tr>
							<td>虾条</td>
							<td><input type="text" class="form-control"  value=""/></td>
						</tr>
						
					</table>
					<div class="col-xs-12 text-center">
						<input type="button" class="btncss jl-btn-warm" onclick="" value="提交">
					</div>
					
				</div>-->
				
			</form>
			
		</div>
	</body>

	<script>
		/*详情*/
		function salesOpeningDetail() {
			layer.open({
				type: 1,
				title: "销售开单详情 ",
				closeBtn: 1,
				area: ['100%', '100%'],
				content: $("#lookDiv"),
				btn: ['关闭']
			});
		}

		/*申请修改*/
		function salesOpeningAudit() {
			publicMessageLayer("修改该订单", function() {

			})
		}
		
		
		/*生成折损单*/
		function salesOpeningModify(){
			
			/*请根据情况修改if条件*/
			if(true){
				let $checkbox=`<input type="button" class="btncss jl-btn-warm" value="修改" onclick="modifyOrder(this)">`;
				$("#foldLossBtn").parents(".jl-title").find(".r_f").html($checkbox);
				
				/*若之前有折损单，请传入数据*/
				let datajson=[{"goodsid":123,"goodsname":123,"goodsprise":12}];
				
				foldLossAdd("#foldLossBtn",datajson);
				
				$("#foldLossBtn").parents(".jl-title").next().find("input[type='text']").attr("disabled","disabled");
			}else{
				/*之前没有折损单*/
				$("#foldLossBtn").removeClass("hidden");
			}
			
			if(false){
				let $checkbox=`<input type="button" class="btncss jl-btn-warm" value="修改" onclick="modifyOrder(this)">`;
				$("#returnListBtn").parents(".jl-title").find(".r_f").html($checkbox);
				
				/*若之前有返货单据，请传入数据*/
				let datajson=[{"goodsid":123,"goodsname":123},{"goodsid":123,"goodsname":123}];
				
				returnListAdd("#returnListBtn",datajson);
				
				$("#returnListBtn").parents(".jl-title").next().find("input[type='text']").attr("disabled","disabled");
			}else{
				/*之前没有返货单*/
				$("#returnListBtn").removeClass("hidden");
				
				
			}
			
			layer.open({
				type: 1,
				title: "修改销售开单",
				closeBtn: 1,
				area: ['100%', '100%'],
				content: $("#foldlossDiv"),
				btn: ['提交','取消'],
				yes:function (index){
					layer.close(index);

					laysuccess("已提交");
				},
				end: function(index, layero){
					layer.close(index);
					clearForm("foldlossDiv");
					$("#foldlossDiv .jl-panel").remove();
					$(".jl-title .r_f").html("")
  				}
			});
		}
		
		/*新增表格*/
		function TableAdd(thisbtn,$str){
			let $brother=$(thisbtn).parents(".jl-title");
			$brother.after($str);
			$(thisbtn).addClass("hidden");
		}
		/*新增折损单*/
		function foldLossAdd(thisbtn,datajson){
			let $str0=`<div class="row jl-panel">`;
			let $closespan=`<span class="close_span" onclick="delform(this)"><i class="fa fa-times"></i></span>`;
			let $str1=`<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tr>
							<th>折损商品</th><th>单价</th><th>折损数量</th><th>折损金额</th>
						</tr>`;
			let $str2=``;
			let $str3=`</table></div>`;
			let jsonarr;
			if(datajson){
				jsonarr=datajson;
			}else{
				jsonarr=[
				{"goodsid":123,"goodsname":123,"goodsprise":12},
				{"goodsid":123,"goodsname":123,"goodsprise":12}
				];
				$str0=$str0+$closespan;
			}
			for(let arrkey=0;arrkey<jsonarr.length;arrkey++){
				$str2+=`<tr>
							<td class="hidden">`+jsonarr[arrkey]["goodsid"]+`</td>
							<td>`+jsonarr[arrkey]["goodsname"]+`</td>
							<td>`+jsonarr[arrkey]["goodsprise"]+`</td>
							<td><input type="text" class="form-control"  value=""/></td>
							<td><input type="text" class="form-control"  value=""/></td>
						</tr>`;
			}
			TableAdd(thisbtn, $str0+$str1+$str2+$str3);
		}
		/*新增返货单*/
		function returnListAdd(thisbtn,datajson){
			let $str0=`<div class="row jl-panel">`;
			let $closespan=`<span class="close_span" onclick="delform(this)"><i class="fa fa-times"></i></span>`;
			let $str1=`<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tr>
							<th>折损商品</th><th>返货数量</th>
						</tr>`;
						
			let $str2=``;
			let $str3=`</table></div>`;
				
			let jsonarr;
			if(datajson){
				jsonarr=datajson;
			}else{
				jsonarr=[{"goodsid":123,"goodsname":123},{"goodsid":123,"goodsname":123}];
				$str0=$str0+$closespan;
			}
			for(let arrkey=0;arrkey<jsonarr.length;arrkey++){
				$str2+=`<tr>
							<td class="hidden">`+jsonarr[arrkey]["goodsid"]+`</td>
							<td>`+jsonarr[arrkey]["goodsname"]+`</td>
							<td><input type="text" class="form-control" value=""/></td>
						</tr>`;
			}
			
			TableAdd(thisbtn,$str0+$str1+$str2+$str3);
		}
		
		
		
		/*删除商品*/
		function delform(thisspan){
			$(thisspan).parent().prev().find("input").removeClass("hidden");
			$(thisspan).parent().remove();
		}
		
		function modifyOrder(thisInput){
			$(thisInput).parents(".jl-title").next().find("input[type='text']").attr("disabled",false);
			$(thisInput).val("取消");
			$(thisInput).attr("onclick","cancelModifyOrder(this)");
		}
		
		function cancelModifyOrder(thisInput){
			$(thisInput).parents(".jl-title").next().find("input[type='text']").attr("disabled","disabled");
			$(thisInput).val("修改");
			$(thisInput).attr("onclick","modifyOrder(this)");
		}
	</script>

</html>