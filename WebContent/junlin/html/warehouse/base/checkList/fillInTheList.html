<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8" />
		<title>仓库填写盘点单</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../../../../css/bootstrap.min.css" />
		<link rel="stylesheet" href="../../../../css/ace.min.css" />
		<link rel="stylesheet" href="../../../../css/style.css" />
		<link rel="stylesheet" href="../../../../css/style_i.css" />
		<link rel="stylesheet" href="../../../../font/css/font-awesome.min.css" />
		<link rel="stylesheet" href="../../../../js/layer/skin/layer.css" />
		<!--[if IE 7]>
		  <link rel="stylesheet" href="../../../../font/css/font-awesome-ie7.min.css" />
		  <link rel="stylesheet" href="../../../../css/ace-ie.min.css" />
		<![endif]-->

		<link rel="stylesheet" href="../../../../css/mine/all.css" />
		<link rel="stylesheet" href="../../../../css/mine/public.css" />

		<script src="../../../../js/jquery-1.10.2.min.js"></script>
		<script src="../../../../js/bootstrap.min.js"></script>
		<script src="../../../../js/typeahead-bs2.min.js"></script>
		<script src="../../../../js/jquery.dataTables.min.js"></script>
		<script src="../../../../js/jquery.dataTables.bootstrap.js"></script>
		<script src="../../../../js/layer/layer.js" type="text/javascript"></script>
		<script src="../../../../js/laydate/laydate.js" type="text/javascript"></script>

		<script src="../../../../script/public.js" type="text/javascript"></script>
		<script src="../../../../script/Bill.js" type="text/javascript"></script>
		<script src="../../../../script/watermark.js" type="text/javascript"></script>
		<script src="../../../../js/jquery.PrintArea.js"></script>

		<link href="../../../../js/jQuery-searchableSelect/jquery.searchableSelect.css" rel="stylesheet" type="text/css">
		<script src="../../../../js/jQuery-searchableSelect/jquery.searchableSelect.js"></script>
		

		<style type="text/css">
			.col-xs-5 {
				text-align: left !important;
			}
		</style>

	</head>

	<body class="content">
		<div class="page-content clearfix">
			<div id="Member_Ratings">
				<div class="d_Confirm_Order_style" style="margin-top:10px;">
					<h4 class="text-title">仓库填写盘点单</h4>
					<div class="search-div clearfix">
						<div class="clearfix">
							<span class="l_f"> 
							仓库： <select class="warehouse">
								<option value="-1">--全部仓库--</option>
							</select>
							</span>
							<span class="l_f"> 
								日期： <input type="text"  value="" id="dateSearch" placeholder="请选择日期" readonly="readonly" />
							</span>
							<span class="l_f"> 
								制单人： <input type="text"  value="" onblur="cky(this)" />
							</span>
							<span class="r_f"> 
								<input type="button"  class="btncss btn_search" value="搜索" />
							</span>
						</div>

					</div>
					<div class="opration-div clearfix">

					</div>
					<div class="table_menu_list">
						<table class="table table-striped table-hover col-xs-12" id="datatable">
							<thead class="table-header">
								<tr>
									<th>单号</th>
									<th>日期</th>
									<th>仓库</th>
									<th>摘要</th>
									<th>制单人</th>
									<th>状态</th>
									<th width="25%">操作</th>
								</tr>

							</thead>
							<tbody>
								<tr>
									<td>
										<span class="look-span" onclick="otherInvoiceDetail()">PO.2017.09.00054</span>
									</td>
									<td>冷库</td>
									<td>AAA</td>
									<td>212454878</td>
									<td>212454878</td>
									<td>2017.10.02</td>
									<td>
										<input type="button" class="btncss edit" onclick="otherInvoiceModify()" value="编辑" />
										<input type="button" class="btncss edit" onclick="sendTo()" value="送审" />
										<input type="button" class="btncss edit" onclick="orderPrint()" value="打印" />
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!--详情 -->
		<div id="detailDiv" style="display: none;">
			<div class="print-content">

				<form class="container">
					<h3 class="print-title">盘点单</h3>
					<div class="row">
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">仓库：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">时间：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">单号：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
					</div>
					<div id="allgoodDivDetail">
						<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
							<tbody>
								<tr>
									<th>货品编码</th>
									<th>货品名称</th>
									<th>规格</th>
									<th>单位</th>
									<th>账面数量</th>
									<th>实盘数量</th>
									<th>盈亏数量</th>
									<th>业务单价</th>
									<th>金额</th>
								</tr>
								<tr>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
							</tbody>
						</table>

					</div>
					<div class="row">
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">部门：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">业务员：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">制单人：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">摘要：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">财务审核人：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">总经理审核人：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
					</div>

				</form>

			</div>
		</div>

		<div id="editDiv" style="display: none;">
			<div class="print-content">

				<form class="container">
					<h3 class="print-title">盘点单</h3>
					<div class="row">
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">仓库：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">时间：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">单号：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
					</div>

					<table class="table table-bordered table-striped table-hover col-xs-12" border="" cellspacing="0" cellpadding="0">
						<tbody id="goodsTbody">
							<tr>
								<th>货品编码</th>
								<th>货品名称</th>
								<th>规格</th>
								<th>单位</th>
								<th>账面数量</th>
								<th>实盘数量</th>
								<th>盈亏数量</th>
								<th>业务单价</th>
								<th>金额</th>
							</tr>
							<tr>
								<td>123</td>
								<td>123</td>
								<td>123</td>
								<td>123</td>
								<td class="bookNumber">20</td>
								<td><input type="text" class="form-control realNumber" onkeyup="realNumberOnKeyUp(this)"></td>
								<td><input type="text" disabled="disabled" class="form-control amountNumber"></td>
								<td class="businessPrice">10</td>
								<td><input type="text" disabled="disabled" class="form-control amountMoney"></td>
							</tr>

						</tbody>
					</table>
					<div class="row">
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">部门：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">业务员：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">制单人：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-4">
							<div class="form-group">
								<label for="" class="col-xs-5 control-label">摘要：</label>
								<div class="col-xs-7">

								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>

		<!--打印-->
		<div id="printDiv" style="display: none;">
		</div>

	</body>

	<script>
		let goodsArr = [];
		$(function() {
			latdate("#dateSearch");

		})

		/*编辑*/
		function otherInvoiceModify() {
			layer.open({
				type: 1,
				title: "编辑盘点单",
				closeBtn: 1,
				area: ['100%', '100%'],
				content: $("#editDiv"),
				btn: ['提交', '取消'],
				yes: function(index) {
					layer.close(index);

					laysuccess("编辑完成");
					clearForm("editDiv", "");
				},
				end: function(index, layero) {
					layer.close(index);
					clearForm("editDiv", "");
				}
			});
		}

		/*值改变事件*/
		
		function realNumberOnKeyUp(thisinput) {
			pressInteger(thisinput);
			let realNumber = $(thisinput).val() - 0;
			let parentTr = $(thisinput).parents("tr");
			let bookNumber = parentTr.find(".bookNumber").html() - 0;
			let businessPrice = parentTr.find(".businessPrice").html() - 0;
			
			parentTr.find(".amountNumber").val("");
			parentTr.find(".amountMoney").val("");
			
			if(isnotEmpty($(thisinput).val())){
				parentTr.find(".amountNumber").val(realNumber - bookNumber);
				let amountNumber = parentTr.find(".amountNumber").val() - 0;
				parentTr.find(".amountMoney").val(businessPrice * amountNumber);
			}
			
		}

		/*详情*/
		function otherInvoiceDetail() {
			layer.open({
				type: 1,
				title: "盘点单详情",
				closeBtn: 1,
				area: ['100%', '100%'],
				content: $("#detailDiv"),
				btn: ['关闭']
			});
		}

		/*送审*/
		function sendTo() {
			publicMessageLayer("送审", function() {
				/*请在此处添加发送操作*/
				laysuccess("送审完成");
			})
		}

		/*打印*/
		function orderPrint() {
			/*请修改ur地址以及打印次数*/
			
			$.ajax({
				type: "get",
				url: "../../../../json/fornData.json",
				async: true,
				success: function(res) {
					console.log(res)
					let bill = new Bill(res);
					let $content = bill.toPrint();
					$("#printDiv").html("");
					$("#printDiv").append($content);
					$("#printDiv .container").append(watermark("打印次数：" + "12" + "次", "#pickingList"));
					$('.watermark>div').fontFlex(80, 100, 10);
				}
			});
			layer.open({
				type: 1,
				title:"盘点单详情",
				closeBtn: 1,
				area: ['100%', '100%'],
				content: $("#printDiv"),
				btn: ['打印', '关闭'],
				yes: function(index) {
					$("#printDiv .container").printArea();
				},
				end: function(index, layero) {
					layer.close(index);
					$("#printDiv").html("");
				}
			});

		}
	</script>

</html>