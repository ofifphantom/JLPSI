<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jl.psi.mapper.ProcureTableMapper">
	<resultMap id="BaseResultMap" type="com.jl.psi.model.ProcureTable">
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="identifier" jdbcType="VARCHAR" property="identifier" />
		<result column="generate_date" jdbcType="TIMESTAMP" property="generateDate" />
		<result column="supcto_id" jdbcType="VARCHAR" property="supctoId" />
		<result column="effective_period_end" jdbcType="DATE"
			property="effectivePeriodEnd" />
		<result column="goods_arrival_time" jdbcType="DATE" property="goodsArrivalTime" />
		<result column="goods_arrival_place" jdbcType="VARCHAR"
			property="goodsArrivalPlace" />
		<result column="transportation_mode" jdbcType="INTEGER"
			property="transportationMode" />
		<result column="deliveryman" jdbcType="VARCHAR" property="deliveryman" />
		<result column="fax" jdbcType="VARCHAR" property="fax" />
		<result column="phone" jdbcType="VARCHAR" property="phone" />
		<result column="orderer" jdbcType="VARCHAR" property="orderer" />
		<result column="prepaid_amount" jdbcType="DOUBLE" property="prepaidAmount" />
		<result column="department_id" jdbcType="INTEGER" property="departmentId" />
		<result column="originator" jdbcType="VARCHAR" property="originator" />
		<result column="reviewer" jdbcType="VARCHAR" property="reviewer" />
		<result column="terminator" jdbcType="VARCHAR" property="terminator" />
		<result column="financial_reviewer" jdbcType="VARCHAR" property="financialReviewer" />
		<result column="summary" jdbcType="VARCHAR" property="summary" />
		<result column="branch" jdbcType="VARCHAR" property="branch" />
		<result column="state" jdbcType="INTEGER" property="state" />
		<result column="print_num" jdbcType="INTEGER" property="printNum" />
		<result column="plan_type" jdbcType="INTEGER" property="planType" />
		<result column="pay_type" jdbcType="INTEGER" property="payType" />
		<result column="contract_number" jdbcType="VARCHAR" property="contractNumber" />
		<result column="plan_or_order" jdbcType="INTEGER" property="planOrOrder" />
		<result column="before_is_plan" jdbcType="INTEGER" property="beforeIsPlan" />
		<result column="is_other_receipts" jdbcType="INTEGER" property="isOtherReceipts" />
		<result column="payment_evidence1" jdbcType="VARCHAR" property="paymentEvidence1" />
		<result column="payment_evidence2" jdbcType="VARCHAR" property="paymentEvidence2" />
		<result column="payment_evidence3" jdbcType="VARCHAR" property="paymentEvidence3" />
		<result column="payment_evidence4" jdbcType="VARCHAR" property="paymentEvidence4" />
		<result column="payment_evidence5" jdbcType="VARCHAR" property="paymentEvidence5" />
		<result column="payment_evidence6" jdbcType="VARCHAR" property="paymentEvidence6" />
		<result column="originatorName" jdbcType="VARCHAR" property="originatorName" />
		<result column="reviewerName" jdbcType="VARCHAR" property="reviewerName" />
		<result column="terminatorName" jdbcType="VARCHAR" property="terminatorName" />
		<result column="financialReviewerName" jdbcType="VARCHAR" property="financialReviewerName" />
		<result column="departmentName" jdbcType="VARCHAR" property="departmentName" />
		<result column="unitName" jdbcType="VARCHAR" property="unitName" />
		<result column="is_delete" jdbcType="INTEGER" property="isDelete" />
		<result column="parent_id" jdbcType="INTEGER" property="parentId" />
		<result column="postfix" jdbcType="INTEGER" property="postfix" />
		<result column="order_type" jdbcType="INTEGER" property="orderType" />
		<result column="procureTableIdentifier" jdbcType="VARCHAR" property="procureTableIdentifier" />
		<result column="activity_id" jdbcType="INTEGER" property="activityId" />
		<result column="is_app_order" jdbcType="INTEGER" property="isAppOrder" />
		<result column="unitPrice" jdbcType="DOUBLE" property="unitPrice" />
		<result column="totalPrice" jdbcType="DOUBLE" property="totalPrice" />
		<result column="inventoryNum" jdbcType="INTEGER" property="inventoryNum" />
		<result column="returnNum" jdbcType="INTEGER" property="returnNum" />
		<result column="returnMoney" jdbcType="DOUBLE" property="returnMoney" />
		<association property="person" javaType="com.jl.psi.model.Person"
			resultMap="PersonResultMap" />
		<association property="supcto" javaType="com.jl.psi.model.Supcto"
			resultMap="SupctoResultMap" />
		<association property="department" javaType="com.jl.psi.model.Department"
		resultMap="DepartmentResultMap" />
		<association property="shippingMode" javaType="com.jl.psi.model.ShippingMode"
			resultMap="ShippingModeResultMap" />
		<association property="settlementType" javaType="com.jl.psi.model.SettlementType"
			resultMap="SettlementTypeResultMap" />
		<association property="warehouse" javaType="com.jl.psi.model.Warehouse"
			resultMap="WarehouseResultMap" />
		<association property="inventory" javaType="com.jl.psi.model.Inventory"
		resultMap="InventoryResultMap" />
		<collection property="procureCommoditys" ofType="com.jl.psi.model.ProcureCommodity"
			resultMap="ProcureCommodityResultMap" />
		
	</resultMap>  
	<!-- 库存信息 -->
	<resultMap id="InventoryResultMap" type="com.jl.psi.model.Inventory">
		
		
		<result column="inventory" jdbcType="INTEGER" property="inventory" />
		
		<result column="occupied_inventory" jdbcType="INTEGER"
			property="occupiedInventory" />
		
	</resultMap>
	<!--仓库信息-->
	<resultMap id="WarehouseResultMap" type="com.jl.psi.model.Warehouse">
		<id column="wsId" jdbcType="INTEGER" property="id" />
		<result column="wName" jdbcType="VARCHAR" property="name" />
		<result column="wIdentifier" jdbcType="VARCHAR" property="identifier" />
		
	</resultMap>
	<!-- 部门信息 -->
	<resultMap id="DepartmentResultMap" type="com.jl.psi.model.Department">
    <result column="departmentName" jdbcType="VARCHAR" property="name" />
  </resultMap>
	<!-- 采购单商品信息 -->
	<resultMap id="ProcureCommodityResultMap" type="com.jl.psi.model.ProcureCommodity">
		<id column="pcId" jdbcType="INTEGER" property="id" />
		<result column="commodity_id" jdbcType="INTEGER" property="commodityId" />
		<result column="procure_table_id" jdbcType="INTEGER" property="procureTableId" />
		<result column="tax_rate" jdbcType="DOUBLE" property="taxRate" />
		<result column="amount_of_tax" jdbcType="DOUBLE" property="amountOfTax" />
		<result column="total_tax_price" jdbcType="DOUBLE" property="totalTaxPrice" />
		<result column="order_num" jdbcType="INTEGER" property="orderNum" />
		<result column="lot_number" jdbcType="VARCHAR" property="lotNumber" />
		<result column="arrival_quantity" jdbcType="INTEGER" property="arrivalQuantity" />
		<result column="suspend_quantity" jdbcType="INTEGER" property="suspendQuantity" />
		<result column="suspend_price" jdbcType="DOUBLE" property="suspendPrice" />
		<result column="discount" jdbcType="INTEGER" property="discount" />
		<result column="is_largess" jdbcType="INTEGER" property="isLargess" />
		<result column="original_unit_price" jdbcType="DOUBLE"
			property="originalUnitPrice" />
		<result column="business_unit_price" jdbcType="DOUBLE"
			property="businessUnitPrice" />
		<result column="arrival_money" jdbcType="DOUBLE"
			property="arrivalMoney" />
		<result column="surplus_money" jdbcType="DOUBLE"
			property="surplusMoney" />
		<result column="surplus_num" jdbcType="INTEGER" property="surplusNum" />	
		<result column="remarks" jdbcType="VARCHAR" property="remarks" />
		<result column="contains_tax_price" jdbcType="DOUBLE" property="containsTaxPrice" />
		<result column="payment_for_goods" jdbcType="DOUBLE" property="paymentForGoods" />
		<result column="total_price" jdbcType="DOUBLE" property="totalPrice" />
		<result column="specWarehouseId" jdbcType="INTEGER" property="specWarehouseId" />
		<association property="commoditySpecification" javaType="com.jl.psi.model.CommoditySpecification"
			resultMap="CommoditySpecificationResultMap" />
	</resultMap>
	
	<!-- 商品规格信息 -->
	<resultMap id="CommoditySpecificationResultMap" type="com.jl.psi.model.CommoditySpecification">
		<id column="csId" jdbcType="INTEGER" property="id" />
		<result column="specification_identifier" jdbcType="VARCHAR"
			property="specificationIdentifier" />
		<result column="specification_name" jdbcType="VARCHAR"
			property="specificationName" />
		<result column="commodity_id" jdbcType="INTEGER" property="commodityId" />
		<result column="quality_period" jdbcType="INTEGER" property="qualityPeriod" />
		<result column="quality_period_unit" jdbcType="VARCHAR"
			property="qualityPeriodUnit" />
		<result column="mini_order_quantity" jdbcType="INTEGER"
			property="miniOrderQuantity" />
		<result column="add_order_quantity" jdbcType="INTEGER"
			property="addOrderQuantity" />
		<result column="packaging_size" jdbcType="VARCHAR" property="packagingSize" />
		<result column="is_delete" jdbcType="INTEGER" property="isDelete" />
		<result column="warning_number" jdbcType="INTEGER" property="warningNumber" />
		<result column="weight" jdbcType="DOUBLE" property="weight" />
		<result column="operator_identifier" jdbcType="VARCHAR"
			property="operatorIdentifier" />
		<result column="operator_time" jdbcType="TIMESTAMP" property="operatorTime" />
		<result column="state" jdbcType="INTEGER" property="state" />
		<result column="baseUnitName" jdbcType="VARCHAR" property="baseUnitName" />
		<result column="specWarehouseId" jdbcType="INTEGER" property="specWarehouseId" />
		<result column="specWarehouseName" jdbcType="VARCHAR" property="specWarehouseName" />
		<result column="goodsBarCode" jdbcType="VARCHAR" property="goodsBarCode" />
		<association property="commodity" javaType="com.jl.psi.model.Commodity"
			resultMap="CommodityResultMap" />
	</resultMap>

	<!-- 商品信息 -->
	<resultMap id="CommodityResultMap" type="com.jl.psi.model.Commodity">
		<id column="cId" jdbcType="INTEGER" property="id" />
		<result column="classification_id" jdbcType="INTEGER" property="classificationId" />
		<result column="cName" jdbcType="VARCHAR" property="name" />
		<result column="brand" jdbcType="VARCHAR" property="brand" />
		<result column="zero_stock" jdbcType="INTEGER" property="zeroStock" />
		<result column="shout_name" jdbcType="VARCHAR" property="shoutName" />
		<result column="mnemonic_code" jdbcType="VARCHAR" property="mnemonicCode" />
		<result column="basics_information" jdbcType="VARCHAR"
			property="basicsInformation" />
		<result column="attribute" jdbcType="VARCHAR" property="attribute" />
		<result column="cIdentifier" jdbcType="VARCHAR" property="identifier" />
		<result column="supcto_id" jdbcType="INTEGER" property="supctoId" />
		<result column="taxes" jdbcType="DOUBLE" property="taxes" />
	</resultMap>

	<!-- 用户信息 -->
	<resultMap id="PersonResultMap" type="com.jl.psi.model.Person">
		<result column="uname" jdbcType="VARCHAR" property="name" />
	</resultMap>

	<!-- 供货商信息 -->
	<resultMap id="SupctoResultMap" type="com.jl.psi.model.Supcto">
		<id column="sId" jdbcType="INTEGER" property="id" />
		<result column="sName" jdbcType="VARCHAR" property="name" />
		<result column="sIdentifier" jdbcType="VARCHAR" property="identifier" />
		<result column="bank_account" jdbcType="VARCHAR" property="bankAccount" />
		<result column="settlement_type_id" jdbcType="INTEGER" property="settlementTypeId" />
		<result column="settlementTypeName" jdbcType="VARCHAR" property="settlementTypeName" />
	</resultMap>

	<!-- 运输方式 -->
	<resultMap id="ShippingModeResultMap" type="com.jl.psi.model.ShippingMode">
		<result column="smName" jdbcType="VARCHAR" property="name" />
	</resultMap>

	<!-- 结算方式 -->
	<resultMap id="SettlementTypeResultMap" type="com.jl.psi.model.SettlementType">
		<result column="stName" jdbcType="VARCHAR" property="name" />
	</resultMap>


	<sql id="Base_Column_List">
		id, identifier, generate_date, supcto_id,
		effective_period_end,
		goods_arrival_time,
		goods_arrival_place,
		transportation_mode, deliveryman, fax, phone, orderer,
		prepaid_amount,
		department_id, originator, reviewer,terminator, summary, branch,
		state,
		print_num, plan_type,pay_type,contract_number,
		plan_or_order,before_is_plan,payment_evidence1,payment_evidence2,
		payment_evidence3,payment_evidence4,payment_evidence5,payment_evidence6,
		is_delete,parent_id,postfix,order_type,financial_reviewer,is_other_receipts
	</sql>

	<!-- 采购商品的字段 -->
	<sql id="ProcureCommodity_Column_List">
		pc.id pcId, pc.commodity_id, pc.procure_table_id,
		pc.tax_rate,
		pc.amount_of_tax,
		pc.total_tax_price, pc.order_num,
		pc.lot_number, pc.arrival_quantity,
		pc.suspend_quantity,
		pc.suspend_price, pc.discount,
		pc.is_largess,pc.original_unit_price,
		pc.business_unit_price, pc.remarks, 
		pc.contains_tax_price,
		pc.payment_for_goods,
		pc.total_price
	</sql>

	<!--定义一个sql片段 -->
	<sql id="query_where">
		<if test="identifier!=null and identifier!=''">
			AND pt.identifier like '%${identifier}%'
		</if>
		<if test="commodityName!=null and commodityName!=''">
			AND c.name like '%${commodityName}%'
		</if>
		<if test="supctoName!=null and supctoName!='' and supctoName!='其他'">
			AND s.name like '%${supctoName}%'
		</if>
		<if test="supctoName!=null and supctoName!='' and supctoName =='其他'">
			AND pt.is_other_receipts = 1
		</if>
		<if test="generateDate!=null and generateDate!=''">
			AND DATE_FORMAT(pt.generate_date,'%Y-%m-%d') = '${generateDate}'
		</if>
			<if test="beginTime!=null and beginTime!=''">
			AND date_format(pt.generate_date,'%Y-%m-%d') &gt;= #{beginTime}
			AND date_format(pt.generate_date,'%Y-%m-%d') &lt;= #{endTime}
		</if>
		<if test="originator!=null and originator!=''">
			AND p.name like '%${originator}%'
		</if>
		<!-- 采购订单以及采购退货单下的页面 -->
		<if test="planOrOrder!=6">
			<if test="state!=null and state!='-1'">
				<!-- 未送审 -->
				<if test='state=="1" '>
					AND pt.state =1 and pt.is_delete=0
				</if>
				<!-- 审核中 -->
				<if test='state=="2" '>
					<if test='page==6 '>
						AND pt.state = 8
					</if>
					<if test='page!=6 '>
						AND pt.state in (2,8)
					</if>
					
				</if>
				<!-- 通过/终止审核通过 -->
				<if test='state=="3" '>
					<if test="planOrOrder==5">
						AND pt.state = 3
					</if>
					<if test="planOrOrder!=5">
						AND pt.state = 9
					</if>
					
				</if>
				<!-- 审核驳回 -->
				<if test='state=="4" '>
					<if test='page==11 or page==6'>
						AND pt.state = 10
					</if>
					<if test='page!=11 and page!=6'>
						AND pt.state in (10,4)
					</if>
					
				</if>
				<!-- 待付款 -->
				<if test='state=="5" '>
					AND pt.state = 5
				</if>
				<!-- 待收货 -->
				<if test='state=="6" '>
					<if test='page==6'>
						AND pt.state = 6
					</if>
					<if test='page==18'>
						AND pt.state = 3
					</if>
					<if test='page!=6 and page!=18'>
						AND pt.state in (3,6)
					</if>
				</if>
				<!-- 已开单 -->
				<if test='state=="7" '>
					AND pt.state = 13
				</if>
				<!-- 已出库 -->
				<if test='state=="8" '>
					AND pt.state = 14
				</if>
				<!-- 其他 -->
				<if test='state=="9" '>
					<if test='page==11 or page==13'>
						AND pt.state = 11
					</if>
					<if test='page==12 or page==15'>
						AND pt.state = 12
					</if>
					<if test='page==6'>
						AND pt.state in (11,12,15)
					</if>
					<if test='page==1'>
						AND pt.state in (7,12,15)
					</if>
					<if test='page!=11 and page!=12 and page!=13 and page!=6 and page!=15 and page!=1'>
						AND pt.state in (7,11,12,15)
					</if>
				</if>
				<!-- 凭证已回传 -->
				<if test='state=="10" '>
					and pt.state > 5 and pt.state!=7 and pt.state!=9
				</if>
				<!-- 已送至采购开单 -->
				<if test='state=="11" '>
					and pt.state = 15
				</if>
				<!-- 部分入库 -->
				<if test='state=="12" '>
					and pt.state = 11
				</if>
				
			</if>
			<!-- 已删除 -->
				<if test='state=="isDelete"'>
						AND pt.is_delete=1
				</if>
		</if>
		<!-- 其他收货单页面 -->
		<if test="planOrOrder==6">
			<if test='state!=null and state!="-1"'>
				<!-- 未送审 -->
				<if test='state=="1"'>
					AND pt.state =1 and pt.is_delete=0
				</if>
				<!-- 审核中 -->
				<if test='state=="2" '>
					AND pt.state in (8,16,18)
				</if>
				<!-- 审核通过 -->
	 			<if test='state=="3" '>
					AND pt.state =9 
				</if>
				<!-- 审核驳回 -->
				<if test='state=="4" '>
					<if test='page==11 '>
						AND pt.state = 10
					</if>
					<if test='page!=11 '>
						AND pt.state in (10,17,19)
					</if>
				</if>
				<!-- 待收货 -->
				<if test='state=="5" '>
					AND pt.state = 20
				</if>
				<!-- 已开单 -->
				<if test='state=="6" '>
					AND pt.state = 13
				</if>
				<!-- 其他 -->
				<if test='state=="7" '>
					<if test='page==11 '>
						AND pt.state = 11
					</if>
					<if test='page!=11 '>
						AND pt.state in (7,11,12,15)
					</if>
					
				</if>
				<if test='state=="isDelete"'>
						AND pt.is_delete=1
				 </if>
			</if>
		</if>
			<if test="isPlan!=null and isPlan!=''">
			AND pt.plan_or_order=${isPlan}
			</if>
			
			
	</sql>

	<!-- 根据主键查询信息 -->
	<select id="selectByPrimaryKey" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from procure_table
		where id = #{id,jdbcType=INTEGER}
	</select>

	<!-- 根据主键删除 信息 -->
<!-- 	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from
		procure_table
		where id = #{id,jdbcType=INTEGER}
	</delete> -->
		<delete id="delete" parameterType="java.lang.Integer">
		delete from
		procure_table
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<!-- 逻辑删除 -->
    <update id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    	update procure_table set is_delete=1 where id = #{id,jdbcType=INTEGER} 
    </update>
	<!-- 保存全部信息 -->
	<insert id="insert" parameterType="com.jl.psi.model.ProcureTable">
		insert into procure_table (id,
		identifier, generate_date,
		supcto_id, effective_period_end,
		goods_arrival_time,
		goods_arrival_place, transportation_mode,
		deliveryman, fax, phone,
		orderer, prepaid_amount, department_id,
		originator, reviewer,terminator, summary,
		branch, state, print_num,
		plan_type,pay_type,contract_number,
		plan_or_order,before_is_plan,payment_evidence1,payment_evidence2,
		payment_evidence3,payment_evidence4,payment_evidence5,payment_evidence6,
		is_delete,parent_id,postfix,order_type,financial_reviewer,is_other_receipts)
		values (#{id,jdbcType=INTEGER},
		#{identifier,jdbcType=VARCHAR},
		#{generateDate,jdbcType=TIMESTAMP},
		#{supctoId,jdbcType=VARCHAR},
		#{effectivePeriodEnd,jdbcType=DATE},
		#{goodsArrivalTime,jdbcType=DATE},
		#{goodsArrivalPlace,jdbcType=VARCHAR},
		#{transportationMode,jdbcType=INTEGER},
		#{deliveryman,jdbcType=VARCHAR}, #{fax,jdbcType=VARCHAR},
		#{phone,jdbcType=VARCHAR},
		#{orderer,jdbcType=VARCHAR},
		#{prepaidAmount,jdbcType=DOUBLE}, #{departmentId,jdbcType=INTEGER},
		#{originator,jdbcType=VARCHAR}, #{reviewer,jdbcType=VARCHAR},
		#{terminator,jdbcType=VARCHAR},
		#{summary,jdbcType=VARCHAR},
		#{branch,jdbcType=VARCHAR},
		#{state,jdbcType=INTEGER},
		#{printNum,jdbcType=INTEGER},
		#{planType,jdbcType=INTEGER},#{payType,jdbcType=INTEGER},#{contractNumber,jdbcType=INTEGER},
		#{planOrOrder,jdbcType=INTEGER},#{beforeIsPlan,jdbcType=INTEGER},
		#{paymentEvidence1,jdbcType=VARCHAR},#{paymentEvidence2,jdbcType=VARCHAR},#{paymentEvidence3,jdbcType=VARCHAR},
		#{paymentEvidence4,jdbcType=VARCHAR},#{paymentEvidence5,jdbcType=VARCHAR},#{paymentEvidence6,jdbcType=VARCHAR},
		#{isDelete,jdbcType=INTEGER},#{parentId,jdbcType=INTEGER},#{postfix,jdbcType=INTEGER},#{orderType,jdbcType=INTEGER},#{financialReviewer,jdbcType=VARCHAR},#{isOtherReceipts,jdbcType=INTEGER})
	</insert>

	<!-- 保存所选内容的信息 -->
	<insert id="insertSelective" parameterType="com.jl.psi.model.ProcureTable" useGeneratedKeys="true" keyProperty="id">
		insert into procure_table
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="identifier != null">
				identifier,
			</if>
			<if test="generateDate != null">
				generate_date,
			</if>
			<if test="supctoId != null">
				supcto_id,
			</if>
			<if test="effectivePeriodEnd != null">
				effective_period_end,
			</if>
			<if test="goodsArrivalTime != null">
				goods_arrival_time,
			</if>
			<if test="goodsArrivalPlace != null">
				goods_arrival_place,
			</if>
			<if test="transportationMode != null">
				transportation_mode,
			</if>
			<if test="deliveryman != null">
				deliveryman,
			</if>
			<if test="fax != null">
				fax,
			</if>
			<if test="phone != null">
				phone,
			</if>
			<if test="orderer != null">
				orderer,
			</if>
			<if test="prepaidAmount != null">
				prepaid_amount,
			</if>
			<if test="departmentId != null">
				department_id,
			</if>
			<if test="originator != null">
				originator,
			</if>
			<if test="reviewer != null">
				reviewer,
			</if>
			<if test="terminator != null">
				terminator,
			</if>
			<if test="summary != null">
				summary,
			</if>
			<if test="branch != null">
				branch,
			</if>
			<if test="state != null">
				state,
			</if>
			<if test="printNum != null">
				print_num,
			</if>
			<if test="planType != null">
				plan_type,
			</if>
			<if test="payType != null">
				pay_type,
			</if>
			<if test="contractNumber != null">
				contract_number,
			</if>
			<if test="planOrOrder != null">
				plan_or_order,
			</if>
			<if test="beforeIsPlan != null">
				before_is_plan,
			</if>
			<if test="paymentEvidence1 != null">
				payment_evidence1,
			</if>
			<if test="paymentEvidence2 != null">
				payment_evidence2,
			</if>
			<if test="paymentEvidence3 != null">
				payment_evidence3,
			</if>
			<if test="paymentEvidence4 != null">
				payment_evidence4,
			</if>
			<if test="paymentEvidence5 != null">
				payment_evidence5,
			</if>
			<if test="paymentEvidence6 != null">
				payment_evidence6,
			</if>
			<if test="isDelete != null">
				is_delete,
			</if>
			<if test="parentId != null">
				parent_id,
			</if>
			<if test="postfix != null">
				postfix,
			</if>
			<if test="orderType != null">
				order_type,
			</if>
				<if test="activityId != null">
				activity_id,
			</if>
				<if test="isAppOrder != null">
				is_app_order,
			</if>
			<if test="financialReviewer != null">
				financial_reviewer,
			</if>
			<if test="isOtherReceipts != null">
				is_other_receipts,
			</if>
 
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="identifier != null">
				#{identifier,jdbcType=VARCHAR},
			</if>
			<if test="generateDate != null">
				#{generateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="supctoId != null">
				#{supctoId,jdbcType=VARCHAR},
			</if>
			<if test="effectivePeriodEnd != null">
				#{effectivePeriodEnd,jdbcType=DATE},
			</if>
			<if test="goodsArrivalTime != null">
				#{goodsArrivalTime,jdbcType=DATE},
			</if>
			<if test="goodsArrivalPlace != null">
				#{goodsArrivalPlace,jdbcType=VARCHAR},
			</if>
			<if test="transportationMode != null">
				#{transportationMode,jdbcType=INTEGER},
			</if>
			<if test="deliveryman != null">
				#{deliveryman,jdbcType=VARCHAR},
			</if>
			<if test="fax != null">
				#{fax,jdbcType=VARCHAR},
			</if>
			<if test="phone != null">
				#{phone,jdbcType=VARCHAR},
			</if>
			<if test="orderer != null">
				#{orderer,jdbcType=VARCHAR},
			</if>
			<if test="prepaidAmount != null">
				#{prepaidAmount,jdbcType=DOUBLE},
			</if>
			<if test="departmentId != null">
				#{departmentId,jdbcType=INTEGER},
			</if>
			<if test="originator != null">
				#{originator,jdbcType=VARCHAR},
			</if>
			<if test="reviewer != null">
				#{reviewer,jdbcType=VARCHAR},
			</if>
			<if test="terminator != null">
				#{terminator,jdbcType=VARCHAR},
			</if>
			<if test="summary != null">
				#{summary,jdbcType=VARCHAR},
			</if>
			<if test="branch != null">
				#{branch,jdbcType=VARCHAR},
			</if>
			<if test="state != null">
				#{state,jdbcType=INTEGER},
			</if>
			<if test="printNum != null">
				#{printNum,jdbcType=INTEGER},
			</if>
			<if test="planType != null">
				#{planType,jdbcType=INTEGER},
			</if>
			<if test="payType != null">
				#{payType,jdbcType=INTEGER},
			</if>
			<if test="contractNumber != null">
				#{contractNumber,jdbcType=INTEGER},
			</if>
			<if test="planOrOrder != null">
				#{planOrOrder,jdbcType=INTEGER},
			</if>
			<if test="beforeIsPlan != null">
				#{beforeIsPlan,jdbcType=INTEGER},
			</if>
			<if test="paymentEvidence1 != null">
				#{paymentEvidence1,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence2 != null">
				#{paymentEvidence2,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence3 != null">
				#{paymentEvidence3,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence4 != null">
				#{paymentEvidence4,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence5 != null">
				#{paymentEvidence5,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence6 != null">
				#{paymentEvidence6,jdbcType=VARCHAR},
			</if>
			<if test="isDelete != null">
				#{isDelete,jdbcType=INTEGER},
			</if>
			<if test="parentId != null">
				#{parentId,jdbcType=INTEGER},
			</if>
			<if test="postfix != null">
				#{postfix,jdbcType=INTEGER},
			</if>
			<if test="orderType != null">
				#{orderType,jdbcType=INTEGER},
			</if>
			 <if test="activityId != null">
				#{activityId,jdbcType=INTEGER},
			</if>
				<if test="isAppOrder != null">
				#{isAppOrder,jdbcType=INTEGER},
			</if>
			<if test="financialReviewer != null">
				#{financialReviewer,jdbcType=VARCHAR},
			</if>
			<if test="isOtherReceipts != null">
				#{isOtherReceipts,jdbcType=INTEGER},
			</if>
		</trim>
	</insert>

	<!-- 根据主键更新所选内容 -->
	<update id="updateByPrimaryKeySelective" parameterType="com.jl.psi.model.ProcureTable">
		update procure_table
		<set>
			<if test="identifier != null">
				identifier = #{identifier,jdbcType=VARCHAR},
			</if>
			<if test="generateDate != null">
				generate_date = #{generateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="supctoId != null">
				supcto_id = #{supctoId,jdbcType=VARCHAR},
			</if>
			<if test="effectivePeriodEnd != null">
				effective_period_end =
				#{effectivePeriodEnd,jdbcType=DATE},
			</if>
			<if test="goodsArrivalTime != null">
				goods_arrival_time = #{goodsArrivalTime,jdbcType=DATE},
			</if>
			<if test="goodsArrivalPlace != null">
				goods_arrival_place =
				#{goodsArrivalPlace,jdbcType=VARCHAR},
			</if>
			<if test="transportationMode != null">
				transportation_mode =
				#{transportationMode,jdbcType=INTEGER},
			</if>
			<if test="deliveryman != null">
				deliveryman = #{deliveryman,jdbcType=VARCHAR},
			</if>
			<if test="fax != null">
				fax = #{fax,jdbcType=VARCHAR},
			</if>
			<if test="phone != null">
				phone = #{phone,jdbcType=VARCHAR},
			</if>
			<if test="orderer != null">
				orderer = #{orderer,jdbcType=VARCHAR},
			</if>
			<if test="prepaidAmount != null">
				prepaid_amount = #{prepaidAmount,jdbcType=DOUBLE},
			</if>
			<if test="departmentId != null">
				department_id = #{departmentId,jdbcType=INTEGER},
			</if>
			<if test="originator != null">
				originator = #{originator,jdbcType=VARCHAR},
			</if>
			<if test="reviewer != null">
				reviewer = #{reviewer,jdbcType=VARCHAR},
			</if>
			<if test="terminator != null">
				terminator = #{terminator,jdbcType=VARCHAR},
			</if>
			<if test="summary != null">
				summary = #{summary,jdbcType=VARCHAR},
			</if>
			<if test="branch != null">
				branch = #{branch,jdbcType=VARCHAR},
			</if>
			<if test="state != null">
				state = #{state,jdbcType=INTEGER},
			</if>
			<if test="printNum != null">
				print_num = #{printNum,jdbcType=INTEGER},
			</if>
			<if test="planType != null">
				plan_type = #{planType,jdbcType=INTEGER},
			</if>
			<if test="payType != null">
				pay_type = #{payType,jdbcType=INTEGER},
			</if>
			<if test="contractNumber != null">
				contract_number = #{contractNumber,jdbcType=INTEGER},
			</if>
			<if test="planOrOrder != null">
				plan_or_order = #{planOrOrder,jdbcType=INTEGER},
			</if>
			<if test="beforeIsPlan != null">
				before_is_plan = #{beforeIsPlan,jdbcType=INTEGER},
			</if>
			<if test="paymentEvidence1 != null">
				payment_evidence1 = #{paymentEvidence1,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence2 != null">
				payment_evidence2 = #{paymentEvidence2,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence3 != null">
				payment_evidence3 = #{paymentEvidence3,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence4 != null">
				payment_evidence4 = #{paymentEvidence4,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence5 != null">
				payment_evidence5 = #{paymentEvidence5,jdbcType=VARCHAR},
			</if>
			<if test="paymentEvidence6 != null">
				payment_evidence6 = #{paymentEvidence6,jdbcType=VARCHAR},
			</if>
			<if test="isDelete != null">
				is_delete = #{isDelete,jdbcType=INTEGER},
			</if>
			<if test="parentId != null">
				parent_id = #{parentId,jdbcType=INTEGER},
			</if>
			<if test="postfix != null">
				postfix = #{postfix,jdbcType=INTEGER},
			</if>
			<if test="orderType != null">
				order_type = #{orderType,jdbcType=INTEGER},
			</if>
			<if test="financialReviewer != null">
				financial_reviewer = #{financialReviewer,jdbcType=VARCHAR},
			</if>
			<if test="isOtherReceipts != null">
				is_other_receipts = #{isOtherReceipts,jdbcType=INTEGER},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>

	<!-- 根据主键更新全部内容 -->
	<update id="updateByPrimaryKey" parameterType="com.jl.psi.model.ProcureTable">
		update
		procure_table
		set identifier = #{identifier,jdbcType=VARCHAR},
		generate_date = #{generateDate,jdbcType=TIMESTAMP},
		supcto_id =
		#{supctoId,jdbcType=VARCHAR},
		effective_period_end =
		#{effectivePeriodEnd,jdbcType=DATE},
		goods_arrival_time =
		#{goodsArrivalTime,jdbcType=DATE},
		goods_arrival_place =
		#{goodsArrivalPlace,jdbcType=VARCHAR},
		transportation_mode =
		#{transportationMode,jdbcType=INTEGER},
		deliveryman =
		#{deliveryman,jdbcType=VARCHAR},
		fax = #{fax,jdbcType=VARCHAR},
		phone =
		#{phone,jdbcType=VARCHAR},
		orderer = #{orderer,jdbcType=VARCHAR},
		prepaid_amount = #{prepaidAmount,jdbcType=DOUBLE},
		department_id =
		#{departmentId,jdbcType=INTEGER},
		originator =
		#{originator,jdbcType=VARCHAR},
		reviewer =
		#{reviewer,jdbcType=VARCHAR},
		terminator =
		#{terminator,jdbcType=VARCHAR},
		summary = #{summary,jdbcType=VARCHAR},
		branch = #{branch,jdbcType=VARCHAR},
		state = #{state,jdbcType=INTEGER},
		print_num = #{printNum,jdbcType=INTEGER},
		plan_type =
		#{planType,jdbcType=INTEGER},
		pay_type =
		#{payType,jdbcType=INTEGER},
		contract_number =
		#{contractNumber,jdbcType=INTEGER},
		plan_or_order =
		#{planOrOrder,jdbcType=INTEGER},
		before_is_plan =
		#{beforeIsPlan,jdbcType=INTEGER},
		payment_evidence1 =
		#{paymentEvidence1,jdbcType=VARCHAR},
		payment_evidence2 =
		#{paymentEvidence2,jdbcType=VARCHAR},
		payment_evidence3 =
		#{paymentEvidence3,jdbcType=VARCHAR},
		payment_evidence4 =
		#{paymentEvidence4,jdbcType=VARCHAR},
		payment_evidence5 =
		#{paymentEvidence5,jdbcType=VARCHAR},
		payment_evidence6 =
		#{paymentEvidence6,jdbcType=VARCHAR},
		is_delete = #{isDelete,jdbcType=INTEGER},
		parent_id = #{parentId,jdbcType=INTEGER},
		order_type = #{orderType,jdbcType=INTEGER},
		postfix = #{postfix,jdbcType=INTEGER},
		financial_reviewer =
		#{financialReviewer,jdbcType=VARCHAR},
		is_other_receipts =
		#{isOtherReceipts,jdbcType=INTEGER}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<!-- 查看详情 -->
	<select id="selectMsgToDetail" resultMap="BaseResultMap">
		SELECT
		pt.*,
		<include refid="ProcureCommodity_Column_List" />
		,
		c.*, s. NAME sName,
		s.bank_account,
		s.settlement_type_id,
		sst.name settlementTypeName,
		sm.`name` smName,
		st. NAME stName,
		d.`name`
		departmentName,
		u.`name` originatorName,
		us.`name` reviewerName,
		us1.`name` terminatorName,
		us2.`name` financialReviewerName,
		pta.identifier procureTableIdentifier,
		pca.arrival_quantity surplus_num    
		FROM
			procure_table pt
		LEFT JOIN procure_commodity pc ON pc.procure_table_id = pt.id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		LEFT JOIN settlement_type sst ON sst.id = s.settlement_type_id
		LEFT JOIN shipping_mode sm ON sm.id = pt.transportation_mode
		LEFT JOIN settlement_type st ON st.id = pt.pay_type
		LEFT JOIN department d ON d.id = pt.department_id
		LEFT JOIN procure_table pta ON pt.parent_id = pta.id
		LEFT JOIN procure_commodity pca ON pca.procure_table_id = pta.id
		LEFT JOIN (
			SELECT
				`name`,
				identifier
			FROM
				person
		) u ON u.identifier = pt.originator
		LEFT JOIN (
			SELECT
				`name`,
				identifier
			FROM
				person
		) us ON us.identifier = pt.reviewer
		LEFT JOIN (
			SELECT
				`name`,
				identifier
			FROM
				person
		) us1 ON us1.identifier = pt.terminator
		LEFT JOIN (
			SELECT
				`name`,
				identifier
			FROM
				person
		) us2 ON us2.identifier = pt.financial_reviewer
		LEFT JOIN (
			SELECT
				cs.id csId,
				cm. NAME cName,
				cm.identifier cIdentifier,
				cs.specification_identifier,
				cs.specification_name,
				cm.brand,
				cm.taxes,
				un.`name` baseUnitName,
				un.bar_code goodsBarCode,
				it.warehouse_id specWarehouseId,
				w.`name` specWarehouseName
			FROM
				commodity_specification cs
			LEFT JOIN commodity cm on cm.id=cs.commodity_id
			LEFT JOIN inventory it on it.specification_id=cs.id
			LEFT JOIN warehouse w on w.id=it.warehouse_id
			LEFT JOIN unit un ON un.specification_id = cs.id AND un.basic_unit = 1
		) c ON c.csId = pc.commodity_id
		where pt.id = #{id,jdbcType=INTEGER}
	</select>



	<!-- 根据id列表更改状态 -->
	<update id="updateStateByIds" parameterType="java.util.Map">
		update procure_table set state = #{state}
		<if test="reviewer != null">
			,reviewer = #{reviewer,jdbcType=VARCHAR}
		</if>
		<if test="terminator != null">
			,terminator = #{terminator,jdbcType=VARCHAR}
		</if>
		<if test="financialReviewer != null">
			,financial_reviewer = #{financialReviewer,jdbcType=VARCHAR}
		</if>
		where id in (
		<foreach collection="ids" item="item" index="index" separator=",">
			#{item}
		</foreach>
		)
		and state!=7

	</update>
	<!-- 根据父id列表更改入库单状态 -->
	<update id="updateStateByParentIds" parameterType="java.util.Map">
		update procure_table set state = #{state}
		where parent_id in (
		<foreach collection="ids" item="item" index="index" separator=",">
			#{item}
		</foreach>
		)
		<if test="beforeState != null">
			and state = #{beforeState}
		</if>
		and plan_or_order=3

	</update>

	<!-- 根据id列表获取信息 -->
	<select id="getProcureTableByIds" parameterType="java.util.List"
		resultMap="BaseResultMap">
		select * from procure_table where id in (
		<foreach collection="list" item="item" separator=",">
			#{item}
		</foreach>
		)

	</select>




	<!-- 获取原始单价(即最新一次的采购单价) -->
	<select id="getOriginalUnitPrice" resultType="Double">
		SELECT
		pc.original_unit_price
		FROM
		procure_table pt
		LEFT JOIN procure_commodity
		pc on pc.procure_table_id=pt.id
		where
		pt.state=13
		and pt.is_delete=0 and
		pc.commodity_id=#{commodityId}
		ORDER BY
		pt.generate_date desc
		LIMIT 1

	</select>

	<!--获取入库数量  -->
	<select id="getArrivalNum" resultType="Integer">
		SELECT
		pc.arrival_quantity
		FROM
		procure_table pt
		LEFT JOIN procure_commodity
		pc on pc.procure_table_id=pt.id
		where
		pt.state=13 and pt.is_delete=0
		and
		pc.commodity_id=#{commodityId}
		ORDER BY
		pt.generate_date desc
		LIMIT 1

	</select>
	
	<!-- 根据主键批量查询信息 -->
	<select id="selectBatchByPrimaryKey" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from procure_table
		where id in (
		<foreach collection="list" item="item" separator=",">
			#{item}
		</foreach>
		)
	</select>

	<!-- 根据主键批量删除 信息 -->
	<delete id="deleteBatchByPrimaryKey">
		delete from
		procure_table
		where id in (
		<foreach collection="list" item="item" separator=",">
			#{item}
		</foreach>
		)
	</delete>
	
	<!-- 查找最大的编号 -->
	<select id="selectMaxIdentifier" resultType="java.lang.String">
		select MAX(identifier) from procure_table 
	</select>
	
	<!-- 查找最大的编号 单据类型为入库单/开单/退货单 -->
	<select id="selectMaxIdentifierToOpeningAndReturn" resultType="java.lang.String">
		select MAX(identifier) from procure_table where  plan_or_order in (3,4,5)
	</select>
	
	<!-- 查找最大的编号  单据类型为采购计划单/采购订单 -->
	<select id="selectMaxIdentifierToPlanAndOrder" resultType="java.lang.String">
		select MAX(identifier) from procure_table where  plan_or_order in (1,2)
	</select>
	
	<!-- 查找单据类型为其他收货单的最大的编号 -->
	<select id="selectMaxIdentifierToOtherReceipts" resultType="java.lang.String">
		select MAX(identifier) from procure_table where  plan_or_order=6
	</select>
	
	<!-- 查找是否有相应的单据 -->
	<select id="selectIsHasGodownEntry" resultMap="BaseResultMap">
		select id,identifier,postfix from procure_table where parent_id=#{parentId,jdbcType=INTEGER} and plan_or_order=#{planOrOrder,jdbcType=INTEGER}
	</select>
	
	<!-- 根据parentId 以及planOrOrder 删除 信息 -->
	<delete id="deleteByParentIdAndPlanOrOrder">
		delete from
		procure_table
		where parent_id=#{parentId,jdbcType=INTEGER} and plan_or_order=#{planOrOrder,jdbcType=INTEGER}
	</delete>
	
	<!-- 获取供退货单引用的销售订单信息 -->
	<select id="getPurchaseTableByState" resultMap="BaseResultMap">
	SELECT
		pt.id,
		pt.supcto_id,
		pt.identifier,
		pt.transportation_mode,
		pt.deliveryman,
		pt.goods_arrival_place,
		pc.arrival_quantity,
		s.`name` sName,
		pt.phone,
		pt.fax
	FROM
		procure_table pt
	LEFT JOIN procure_commodity pc on pc.procure_table_id=pt.id
	LEFT JOIN supcto s ON s.id = pt.supcto_id
	WHERE
		pt.state IN (11, 12, 13)
	and pt.is_delete=0
	and pt.plan_or_order=2
	</select>
	
	<!-- 部分入库申请采购开单 修改部分入库单的状态 -->
	<!-- <update id="warehouseHalfApplyBilling" parameterType="com.jl.psi.model.ProcureTable">
	update procure_table pt set pt.state=15 where pt.parent_id=#{parentId,jdbcType=INTEGER} and pt.plan_or_order=3
	</update> -->
	
	
	
	

	<!-- datatable 分页 start -->
	<!-- 查询记录总条数 -->
	<select id="iTotalRecords" resultType="java.lang.Integer">
		SELECT
		COUNT(1)
		FROM
		(
		select count(1)
		from
		procure_table pt
		LEFT JOIN procure_commodity pc ON pc.procure_table_id = pt.id
		LEFT JOIN supcto s on s.id=pt.supcto_id
		LEFT JOIN commodity_specification cs on cs.id=pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN procure_table pta ON pt.parent_id = pta.id
		LEFT JOIN person p ON p.identifier = pt.originator
		WHERE
		1=1
		<if test="planOrOrder==1">
			and (pt.plan_or_order = 1
			or pt.before_is_plan=1)
		</if>
		<if test="planOrOrder==2">
			and pt.plan_or_order = 2
 		</if>
		<if test="page==2">
			and pt.state = 2
			and pt.plan_or_order = 2
		</if>
		<if test="page==5">
			and pt.state >= 5 and pt.state!=7 and pt.state!=9
			and pt.pay_type=1
			and pt.plan_or_order = 2
		</if>
		<if test="page==6">
			and pt.state >= 6 and pt.state != 7 and pt.state!=9
			and pt.pay_type=1
			and pt.plan_or_order = 2
		</if>
		<if test="page==8">
			and pt.state = 8
			and pt.plan_or_order = 2
		</if>
		<if test="page==11">
			and pt.state in (3,6,11,10)
			and pt.plan_or_order = 2
		</if>
		<if test="page==12">
			and pt.state in (12,13)
			and pt.plan_or_order = 3
			and pt.postfix is null
			and pt.is_other_receipts=0
		</if>
		<if test="page==13">
			and pt.state in (8,9,11,13,15)
			and pt.plan_or_order = 3
			and pt.postfix is not null
			and pt.is_other_receipts=0
		</if>
		<if test="page==14">
			and pt.state = 13
			and pt.plan_or_order = 4
		</if>
		<if test="page==15">
			and pt.state in (12,15)
			and pt.plan_or_order = 3
		</if>
		<if test="page==16">
			and pt.plan_or_order = 5
		</if>
		<if test="page==17">
			and pt.state = 2
			and pt.plan_or_order = 5
		</if>
		<if test="page==18">
			and pt.state in (3,14)
			and pt.plan_or_order = 5
		</if>
		<if test="page==19">
			and pt.state = 14
			and pt.plan_or_order = 5
		</if>
		<if test="page==20">
			and pt.plan_or_order = 6
		</if>
		<if test="page==21">
			and pt.plan_or_order = 6
			and pt.state = 16
		</if>
		<if test="page==22">
			and pt.plan_or_order = 6
			and pt.state = 18
		</if>
		<if test="page==23">
			and pt.plan_or_order = 6
			and pt.state in (20,10,11)
		</if>
		<if test="page==24">
			and pt.state = 8
			and pt.plan_or_order = 6
		</if>
		<if test="page==25">
			and pt.state in (12,13)
			and pt.plan_or_order = 3
			and pt.postfix is null
			and pt.is_other_receipts=1
		</if>
		<if test="page==26">
			and pt.state in (8,9,11,13,15)
			and pt.plan_or_order = 3
			and pt.postfix is not null
			and pt.is_other_receipts=1
		</if>
		GROUP BY
		pt.id
		) msg
	</select>
	<!-- 查询所有信息 结果集 -->
	<select id="selectForSearch" resultMap="BaseResultMap">
		SELECT
		pt.*,
		<include refid="ProcureCommodity_Column_List" />
		,
		s.name sName,
		c.name cName,
		cs.specification_name,
		pta.identifier procureTableIdentifier,
		p.name originatorName
		FROM
		procure_table pt
		LEFT JOIN procure_commodity pc ON pc.procure_table_id = pt.id
		LEFT JOIN supcto s on s.id=pt.supcto_id
		LEFT JOIN commodity_specification cs on cs.id=pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN procure_table pta ON pt.parent_id = pta.id
		LEFT JOIN person p ON p.identifier = pt.originator
		WHERE 1=1
		<if test="planOrOrder==1">
			and (pt.plan_or_order = 1
			or pt.before_is_plan=1)
		</if>
		<if test="planOrOrder==2">
			and pt.plan_or_order = 2
			 
		</if>
		<if test="page==2">
			and pt.state = 2
			and pt.plan_or_order = 2
		</if>
		<if test="page==5">
			and pt.state >= 5 and pt.state!=7 and pt.state!=9
			and pt.pay_type=1
			and pt.plan_or_order = 2
		</if>
		<if test="page==6">
			and pt.state >= 6 and pt.state != 7 and pt.state!=9
			and pt.pay_type=1
			and pt.plan_or_order = 2
		</if>
		<if test="page==8">
			and pt.state = 8
			and pt.plan_or_order = 2
		</if>
		<if test="page==11">
			and pt.state in (3,6,11,10)
			and pt.plan_or_order = 2
		</if>
		<if test="page==12">
			and pt.state in (12,13)
			and pt.plan_or_order = 3
			and pt.postfix is null
			and pt.is_other_receipts=0
		</if>
		<if test="page==13">
			and pt.state in (8,9,11,13,15)
			and pt.plan_or_order = 3
			and pt.postfix is not null
			and pt.is_other_receipts=0
		</if>
		<if test="page==14">
			and pt.state = 13
			and pt.plan_or_order = 4
		</if>
		<if test="page==15">
			and pt.state in (12,15)
			and pt.plan_or_order = 3
		</if>
		<if test="page==16">
			and pt.plan_or_order = 5
		</if>
		<if test="page==17">
			and pt.state = 2
			and pt.plan_or_order = 5
		</if>
		<if test="page==18">
			and pt.state in (3,14)
			and pt.plan_or_order = 5
		</if>
		<if test="page==19">
			and pt.state = 14
			and pt.plan_or_order = 5
		</if>
		<if test="page==20">
			and pt.plan_or_order = 6
		</if>
		<if test="page==21">
			and pt.plan_or_order = 6
			and pt.state = 16
		</if>
		<if test="page==22">
			and pt.plan_or_order = 6
			and pt.state = 18
		</if>
		<if test="page==23">
			and pt.plan_or_order = 6
			and pt.state in (20,10,11)
		</if>
		<if test="page==24">
			and pt.state = 8
			and pt.plan_or_order = 6
		</if>
		<if test="page==25">
			and pt.state in (12,13)
			and pt.plan_or_order = 3
			and pt.postfix is null
			and pt.is_other_receipts=1
		</if>
		<if test="page==26">
			and pt.state in (8,9,11,13,15)
			and pt.plan_or_order = 3
			and pt.postfix is not null
			and pt.is_other_receipts=1
		</if>
		<include refid="query_where"></include>
		<if test="desc!=null and desc!='' ">
			order by ${desc} desc
		</if>
		<if test="asc!=null and asc!='' ">
			order by ${asc} asc
		</if>
		<!-- limit ${iDisplayStart},${pageDisplayLength} -->
	</select>
	<!-- 通过查询条件过滤后的总记录 -->
	<select id="iTotalDisplayRecords" resultType="java.lang.Integer">
		SELECT
		COUNT(1)
		FROM
		(
		select count(1)
		from
		procure_table pt
		LEFT JOIN procure_commodity pc ON pc.procure_table_id = pt.id
		LEFT JOIN supcto s on s.id=pt.supcto_id
		LEFT JOIN commodity_specification cs on cs.id=pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN procure_table pta ON pt.parent_id = pta.id
		LEFT JOIN person p ON p.identifier = pt.originator
		WHERE
		1=1
		<if test="planOrOrder==1">
			and (pt.plan_or_order = 1
			or pt.before_is_plan=1)
		</if>
		<if test="planOrOrder==2">
			and pt.plan_or_order = 2
 		</if>
		<if test="page==2">
			and pt.state = 2
			and pt.plan_or_order = 2
		</if>
		<if test="page==5">
			and pt.state >= 5 and pt.state!=7 and pt.state!=9
			and pt.pay_type=1
			and pt.plan_or_order = 2
		</if>
		<if test="page==6">
			and pt.state >= 6 and pt.state != 7 and pt.state!=9
			and pt.pay_type=1
			and pt.plan_or_order = 2
		</if>
		<if test="page==8">
			and pt.state = 8
			and pt.plan_or_order = 2
		</if>
		<if test="page==11">
			and pt.state in (3,6,11,10)
			and pt.plan_or_order = 2
		</if>
		<if test="page==12">
			and pt.state in (12,13)
			and pt.plan_or_order = 3
			and pt.postfix is null
			and pt.is_other_receipts=0
		</if>
		<if test="page==13">
			and pt.state in (8,9,11,13,15)
			and pt.plan_or_order = 3
			and pt.postfix is not null
			and pt.is_other_receipts=0
		</if>
		<if test="page==14">
			and pt.state = 13
			and pt.plan_or_order = 4
		</if>
		<if test="page==15">
			and pt.state in (12,15)
			and pt.plan_or_order = 3
		</if>
		<if test="page==16">
			and pt.plan_or_order = 5
		</if>
		<if test="page==17">
			and pt.state = 2
			and pt.plan_or_order = 5
		</if>
		<if test="page==18">
			and pt.state in (3,14)
			and pt.plan_or_order = 5
		</if>
		<if test="page==19">
			and pt.state = 14
			and pt.plan_or_order = 5
		</if>
		<if test="page==20">
			and pt.plan_or_order = 6
		</if>
		<if test="page==21">
			and pt.plan_or_order = 6
			and pt.state = 16
		</if>
		<if test="page==22">
			and pt.plan_or_order = 6
			and pt.state = 18
		</if>
		<if test="page==23">
			and pt.plan_or_order = 6
			and pt.state in (20,10,11)
		</if>
		<if test="page==24">
			and pt.state = 8
			and pt.plan_or_order = 6
		</if>
		<if test="page==25">
			and pt.state in (12,13)
			and pt.plan_or_order = 3
			and pt.postfix is null
			and pt.is_other_receipts=1
		</if>
		<if test="page==26">
			and pt.state in (8,9,11,13,15)
			and pt.plan_or_order = 3
			and pt.postfix is not null
			and pt.is_other_receipts=1
		</if>
		<include refid="query_where"></include>
		GROUP BY
		pt.id
		) msg
	</select>
	<!-- datatable 分页 end -->
	
	
	
	<!-- 	查询计划采购订单到期数量-->	
 	<select id="selectExpirationCount" resultType="java.lang.Integer">
		SELECT  COUNT(1)   from procure_table where plan_or_order=1  and  (NOW()>=DATE_SUB(effective_period_end,INTERVAL 2 DAY) OR effective_period_end is NULL)
	</select>
	
	
	
	<!--基础查询条件  -->
	<sql id="query_where_base">
	  	<!--单号  -->
		<if test="identifier!=null and identifier!=''">
			AND pt.identifier like '%${identifier}%'
		</if>
		<!--运输方式  -->
		<if test="shippingModel!=null and shippingModel!='' and shippingModel!=-1">
			AND pt.transportation_mode='${shippingModel}'
		</if>
		
		<!--客户名称分类  -->
		<if test="supctoTypeClassId!=null and supctoTypeClassId!='' and supctoTypeClassId!=-1">
			AND cla.parent_id='${supctoTypeClassId}'
		</if>
		<!--客户名称一级分类  -->
		<if test="supctoTypeClassTwoId!=null and supctoTypeClassTwoId!='' and supctoTypeClassTwoId!=-1">
			AND s.classification_id='${supctoTypeClassTwoId}'
		</if>
		<!--客户名称  -->
		<if test="supctoName!=null and supctoName!=''">
			AND s.name  like '%${supctoName}%'
		</if>
 
		<!--商品名称  -->
		<if test="cname!=null and cname!=''">
			AND c.name like '%${cname}%'
		</if>
		<!-- 商品编码 -->
		<if test="commodity_identifier!=null and commodity_identifier!=''">
			AND cs.specification_identifier like '%${commodity_identifier}%'
		</if>
		<!--品牌  -->
		<if test="brand!=null and brand!=''">
			AND c.brand like '%${brand}%'
		</if>
		<!--开单部门  -->
		<if test="departmentClassOneId!=null and departmentClassOneId!='' and departmentClassOneId!='-1'">
			AND pt.department_id='${departmentClassOneId}'
		</if>
		<!--开单人  -->
		<if test="makeOrderPersonId!=null and makeOrderPersonId!='' and makeOrderPersonId!='-1'">
			AND pt.originator='${makeIdentifier}'
		</if>
		<!--审核部门  -->
			<!--审核部门  -->
		<if test="checkDepartmentId!=null and checkDepartmentId!='' and checkDepartmentId!='-1'">
			AND pt.department_id='${checkDepartmentId}'
		</if>
		<!--审核人  -->
		<if test="checkPersonId!=null and checkPersonId!='' and checkPersonId!=-1">
			AND pt.reviewer='${rewviewIdentifier}'
		</if>
		<!--时间  -->
		<if test="beginTime!=null and beginTime!=''">
			AND
			pt.generate_date
			BETWEEN
			'${beginTime}'
			AND
			DATE_ADD('${closeTime}',INTERVAL 1 DAY)
		</if>
		
		<!--仓库  -->
		<if test="warehouseMsgId!=null and warehouseMsgId!='' and warehouseMsgId!=-1">
			AND i.warehouse_id='${warehouseMsgId}'
		</if>
		
		
		
	</sql>
		<sql id="query_where_base2">
	  	<!--单号  -->
		<if test="identifier!=null and identifier!=''">
			AND pt.identifier like '%${identifier}%'
		</if>
		<!--运输方式  -->
		<if test="shippingModel!=null and shippingModel!='' and shippingModel!=-1">
			AND pt.transportation_mode='${shippingModel}'
		</if>
		
		<!--客户名称分类  -->
		<if test="supctoTypeClassId!=null and supctoTypeClassId!='' and supctoTypeClassId!=-1">
			AND cla.parent_id='${supctoTypeClassId}'
		</if>
		<!--客户名称一级分类  -->
		<if test="supctoTypeClassTwoId!=null and supctoTypeClassTwoId!='' and supctoTypeClassTwoId!=-1">
			AND s.classification_id='${supctoTypeClassTwoId}'
		</if>
		<!--客户名称  -->
		<if test="supctoName!=null and supctoName!=''">
			AND s.name  like '%${supctoName}%'
		</if>
		 
		<!--商品名称  -->
		<if test="cname!=null and cname!=''">
			AND c.name like '%${cname}%'
		</if>
		<!-- 商品编码 -->
		<if test="commodity_identifier!=null and commodity_identifier!=''">
			AND cs.specification_identifier like '%${commodity_identifier}%'
		</if>
		<!--品牌  -->
		<if test="brand!=null and brand!=''">
			AND c.brand like '%${brand}%'
		</if>
		<!--开单部门  -->
		<if test="departmentClassOneId!=null and departmentClassOneId!='' and departmentClassOneId!='-1'">
			AND pt.department_id='${departmentClassOneId}'
		</if>
		<!--开单人  -->
		<if test="makeOrderPersonId!=null and makeOrderPersonId!='' and makeOrderPersonId!='-1'">
			AND pt.originator='${makeIdentifier}'
		</if>
 
		<!--时间  -->
		<if test="beginTime!=null and beginTime!=''">
			AND
			pt.generate_date
			BETWEEN
			'${beginTime}'
			AND
			DATE_ADD('${closeTime}',INTERVAL 1 DAY)
		</if>
		
		<!--仓库  -->
		<if test="warehouseMsgId!=null and warehouseMsgId!='' and warehouseMsgId!=-1">
			AND i.warehouse_id='${warehouseMsgId}'
		</if>
		
		
		
	</sql>
	<sql id="query_where_state">
		<!-- 待审核 -->
		<if test="state==1 and state!=-1">
			AND pt.state=2
		</if>
		<!-- 已审核 -->
		<if test="state==2 and state!=-1">
			AND pt.state IN (3,4,17,19,20)
		</if>
		<!-- 已入库 -->
		<if test="state==3 and state!=-1">
			AND pt.state IN (11,12)
		</if>
		<!-- 已出库 -->
		<if test="state==4 and state!=-1">
			AND pt.state=14
		</if>
		<!-- 已开单 -->
		<if test="state==5 and state!=-1">
			AND pt.state=13
		</if>
		<!-- 已终止 -->
		<if test="state==6 and state!=-1">
			AND pt.state=9
		</if>
		<!-- 其他 -->
		<if test="state==7 and state!=-1">
			AND pt.state not IN (2,3,4,17,19,20,11,12,14,13,9)
		</if>
	</sql>
	
	<!--采购订单汇总表 -->
	<select id="reportProcureOrderGether" resultMap="BaseResultMap">
	SELECT
		pt.id,
		s.identifier sIdentifier,
		s.`name` sName,
		pt.state,
		SUM(pc.total_tax_price) total_tax_price,
		SUM(pc.suspend_price) suspend_price,
		SUM(pc.arrival_quantity * pc.business_unit_price*(1+pc.tax_rate)) total_price,
		cs.specification_identifier specification_identifier
	FROM
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		 LEFT JOIN classification cla ON cla.id = s.classification_id
		LEFT JOIN person k ON k.identifier = pt.originator
		LEFT JOIN person r ON r.identifier = pt.reviewer
		LEFT JOIN inventory i ON i.specification_id = cs.id
	WHERE
	1=1 and pt.is_delete=0 and pt.plan_or_order = 2
	<include refid="query_where_base" ></include>
	<include refid="query_where_state" ></include>
	GROUP BY s.id
	ORDER BY
	pt.id DESC
	</select>
	
	<!--采购订单明细表  -->	
	<select id="reportProcureOrderDetail"  resultMap="BaseResultMap">
 
	 SELECT
		s.`name` sName,
		pt.identifier,
		pt.generate_date,
		pt.goods_arrival_time,
		i.occupied_inventory,
		c.identifier cIdentifier,
		c.`name` cName,
		cs.specification_name,
		u.`name` baseUnitName,
		 
		pc.business_unit_price,
	  pc.total_tax_price,
		pc.arrival_quantity,
		(
			pc.arrival_quantity * pc.business_unit_price*(1+pc.tax_rate)
		) arrival_money,
		pc.suspend_quantity,
		pc.suspend_price,
	 	(
			pc.order_num - pc.arrival_quantity
		) surplus_num,
		(
			(
				pc.order_num - pc.arrival_quantity
			) * pc.business_unit_price
		) surplus_money,
		pc.remarks,
		cs.specification_identifier specification_identifier
	FROM
		procure_table pt
	LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
	LEFT JOIN supcto s ON s.id = pt.supcto_id
	LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
	LEFT JOIN commodity c ON c.id = cs.commodity_id
	LEFT JOIN unit u ON u.specification_id = cs.id and u.basic_unit=1
	LEFT JOIN classification cla ON cla.id = s.classification_id
	LEFT JOIN person k ON k.identifier = pt.originator
	LEFT JOIN person r ON r.identifier = pt.reviewer
	LEFT JOIN inventory i ON i.specification_id = cs.id
	WHERE
		1 = 1 and pt.is_delete=0
	AND pt.plan_or_order = 2
	 <include refid="query_where_base" />
	 <include refid="query_where_state" />
	 
	GROUP BY
		pc.id
	ORDER BY
		pt.id DESC  
	</select>
	
	<!-- 采购计划汇总表 -->
	<select id="reportProcurePlanOrderGether"  resultMap="BaseResultMap">
	SELECT
		s.identifier sIdentifier,
		s.`name` sName,
		pt.identifier,
		SUM(pc.total_price) total_tax_price,
		pt.goods_arrival_time,
		cs.specification_identifier specification_identifier
	FROM
		procure_table pt  
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		 LEFT JOIN classification cla ON cla.id = s.classification_id
		LEFT JOIN person k ON k.identifier = pt.originator
		LEFT JOIN person r ON r.identifier = pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id

 	WHERE (pt.plan_or_order = 1 or pt.before_is_plan=1)  and pt.is_delete=0

	<!--单号  -->
		<if test="identifier!=null and identifier!=''">
			AND pt.identifier like '%${identifier}%'
		</if>
		<!--运输方式  -->
		<if test="shippingModel!=null and shippingModel!='' and shippingModel!=-1">
			AND pt.transportation_mode='${shippingModel}'
		</if>
		
		<!--客户名称分类  -->
		<if test="supctoTypeClassId!=null and supctoTypeClassId!='' and supctoTypeClassId!=-1">
			AND cla.parent_id='${supctoTypeClassId}'
		</if>
		<!--客户名称一级分类  -->
		<if test="supctoTypeClassTwoId!=null and supctoTypeClassTwoId!='' and supctoTypeClassTwoId!=-1">
			AND s.classification_id='${supctoTypeClassTwoId}'
		</if>
		<!--客户名称  -->
		<if test="supctoName!=null and supctoName!=''">
			AND s.name  like '%${supctoName}%'
		</if>
		 
		<!--商品名称  -->
		<if test="cname!=null and cname!=''">
			AND c.name like '%${cname}%'
		</if>
		<!-- 商品编码 -->
		<if test="commodity_identifier!=null and commodity_identifier!=''">
			AND cs.specification_identifier like '%${commodity_identifier}%'
		</if>
		<!--品牌  -->
		<if test="brand!=null and brand!=''">
			AND c.brand like '%${brand}%'
		</if>
		<!--开单部门  -->
		<if test="departmentClassOneId!=null and departmentClassOneId!='' and departmentClassOneId!='-1'">
			AND pt.department_id='${departmentClassOneId}'
		</if>
		<!--开单人  -->
		<if test="makeOrderPersonId!=null and makeOrderPersonId!='' and makeOrderPersonId!='-1'">
			AND pt.originator='${makeIdentifier}'
		</if>
 
		<!--时间  -->
		<if test="beginTime!=null and beginTime!=''">
			AND
			pt.generate_date
			BETWEEN
			'${beginTime}'
			AND
			DATE_ADD('${closeTime}',INTERVAL 1 DAY)
		</if>
		
		<!--仓库  -->
		<if test="warehouseMsgId!=null and warehouseMsgId!='' and warehouseMsgId!=-1">
			AND i.warehouse_id='${warehouseMsgId}'
		</if>
 	GROUP BY pt.id
 	ORDER BY s.name desc
	</select>
	
	<!-- 采购计划明细表 -->
	<select id="reportProcurePlanOrderDetail" resultMap="BaseResultMap">
	
	SELECT
		s.`name` sName,
		pt.identifier,
		pt.generate_date,
		i.occupied_inventory,
		pt.goods_arrival_time,
		c.identifier cIdentifier,
		c.`name` cName,
		cs.specification_name,
		u.`name` baseUnitName,
		pc.business_unit_price,
		pc.order_num,
		pc.total_price,
		pc.remarks,
		cs.specification_identifier specification_identifier
	
	FROM
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id and u.basic_unit=1
		LEFT JOIN classification cla ON cla.id=s.classification_id
		LEFT JOIN person k ON k.identifier=pt.originator
		LEFT JOIN person r ON r.identifier=pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id
	
	
	
	WHERE (pt.plan_or_order = 1 or pt.before_is_plan=1)  and pt.is_delete=0
	
	<include refid="query_where_base2" />
	 GROUP BY
	pc.id
	ORDER BY pt.id desc
	</select>
	<!--采购开单明细表/汇总表  -->
	<sql id="query5">
		<!-- 汇总表 -->
		<if test="type==1">
			GROUP BY s.id
		</if>
		<!--明细表  -->
		 <if test="type==2">
			GROUP BY pc.id
		</if>
	</sql>
	
	<!-- 采购开单汇总 -->
	<select id="reportProcureFinishOrderDetailOrGether"  resultMap="BaseResultMap">
	SELECT
		s.identifier sIdentifier,
		s.`name` sName,
		i.occupied_inventory,
		SUM( IFNULL(pc.arrival_quantity,0) * pc.business_unit_price ) arrival_money,
		SUM( pc.arrival_quantity * pc.business_unit_price * pc.tax_rate ) amount_of_tax,
		SUM( pc.arrival_quantity * pc.business_unit_price*(1+pc.tax_rate) ) total_tax_price,
		pt.generate_date,
		pt.identifier,
		c.identifier cIdentifier,
		c.`name` cName,
		cs.specification_name,
		cs.specification_identifier specification_identifier,
	 	pc.business_unit_price,
	 	pc.original_unit_price,
		pc.order_num,
		IFNULL(pc.arrival_quantity,0) arrival_quantity,
		pc.remarks,
		pc.discount,
		u.name baseUnitName,
		<if test="type==1">
			IFNULL(
		(
		SELECT
			sum(ppc.arrival_quantity) 
		FROM
			procure_table ppt
			LEFT JOIN procure_commodity ppc ON ppc.procure_table_id = ppt.id 
		WHERE
			1 = 1 
			AND ppt.supcto_id=pt.supcto_id
			AND ppt.is_delete = 0 
			AND ppt.plan_or_order = 5 
		GROUP BY
			ppt.supcto_id
		),
		0 
	) returnNum,
	IFNULL(
		(
		SELECT
			sum(ppc.total_price) 
		FROM
			procure_table ppt
			LEFT JOIN procure_commodity ppc ON ppc.procure_table_id = ppt.id 
		WHERE
			1 = 1 
			AND ppt.supcto_id=pt.supcto_id
			AND ppt.is_delete = 0 
			AND ppt.plan_or_order = 5 
		GROUP BY
			ppt.supcto_id
		),
		0 
	) returnMoney,
		
		</if>
		
pc.tax_rate
	FROM
		procure_table pt
	LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
	LEFT JOIN supcto s ON s.id = pt.supcto_id
	LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
	LEFT JOIN commodity c ON c.id = cs.commodity_id
	LEFT JOIN unit u ON u.specification_id = cs.id 
	 LEFT JOIN classification cla ON cla.id = s.classification_id
	LEFT JOIN person k ON k.identifier = pt.originator
	LEFT JOIN person r ON r.identifier = pt.reviewer
	LEFT JOIN inventory i ON i.specification_id=cs.id
	WHERE  pt.plan_or_order=4 AND pt.state=13 and pt.is_delete=0
	<include refid="query_where_base" />
	<include refid="query5" />
	ORDER BY pt.id desc
	</select>
	
	<!-- 入库单 -->
	<select id="reportImportOrderDetailOrGether" resultMap="BaseResultMap">
	SELECT
		pt.state,	
		cs.id csId, 
		pt.identifier,
		pt.order_type,
		
		c.identifier cIdentifier,
		c.`name` cName,
		c.brand,
		cs.specification_name,
		pt.generate_date,
		<if test="type==1">
		sum(i.occupied_inventory) occupied_inventory,
		SUM(pc.arrival_quantity) order_num,
		SUM(pc.business_unit_price*pc.arrival_quantity*(1+pc.tax_rate)) total_tax_price,
		</if>
		<if test="type==2">
		i.occupied_inventory,
		pc.arrival_quantity order_num,
		(pc.business_unit_price*pc.arrival_quantity*(1+pc.tax_rate)) total_tax_price,
		</if>
		pc.arrival_quantity,
		pc.business_unit_price,
		pc.remarks,
		pc.lot_number,
		u.`name` baseUnitName,
		w.`name` specWarehouseName,
		cs.specification_identifier specification_identifier
	FROM 
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id and  u.basic_unit=1
		LEFT JOIN classification cla ON cla.id=s.classification_id
		LEFT JOIN person k ON k.identifier=pt.originator
		LEFT JOIN person r ON r.identifier=pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id
		LEFT JOIN warehouse w ON w.id = i.warehouse_id 
	WHERE 1=1  and pt.plan_or_order = 3 and pt.is_delete=0
	<!--单号  -->
		<if test="identifier!=null and identifier!=''">
			AND pt.identifier like '%${identifier}%'
		</if>
		<!--运输方式  -->
		<if test="shippingModel!=null and shippingModel!='' and shippingModel!=-1">
			AND pt.transportation_mode='${shippingModel}'
		</if>
		
		
 
		<!--商品名称  -->
		<if test="cname!=null and cname!=''">
			AND c.name like '%${cname}%'
		</if>
		<!-- 商品编码 -->
		<if test="commodity_identifier!=null and commodity_identifier!=''">
			AND cs.specification_identifier like '%${commodity_identifier}%'
		</if>
		<!--品牌  -->
		<if test="brand!=null and brand!=''">
			AND c.brand like '%${brand}%'
		</if>
		<!--开单部门  -->
		<if test="departmentClassOneId!=null and departmentClassOneId!='' and departmentClassOneId!='-1'">
			AND pt.department_id='${departmentClassOneId}'
		</if>
		<!--开单人  -->
		<if test="makeOrderPersonId!=null and makeOrderPersonId!='' and makeOrderPersonId!='-1'">
			AND pt.originator='${makeIdentifier}'
		</if>
		
			
		<!--时间  -->
		<if test="beginTime!=null and beginTime!=''">
			AND
			pt.generate_date
			BETWEEN
			'${beginTime}'
			AND
			DATE_ADD('${closeTime}',INTERVAL 1 DAY)
		</if>
		
		<!--仓库  -->
		<if test="warehouseMsgId!=null and warehouseMsgId!='' and warehouseMsgId!=-1">
			AND i.warehouse_id='${warehouseMsgId}'
		</if>
	GROUP BY
	<if test="type==1">
	cs.id
	</if>
	<if test="type==2">
	pc.id
	</if>
	
	order by pt.id desc 
	</select>
	
	<update id="updateByVerification" >
		update procure_table set is_verification=1
		where id=#{id}
	</update>
	
	<!--采购开单付款情况一览表  -->
	<sql id="query_where7">
	  	<!--业务员  -->
		<if test="makeOrderPersonId!=null and makeOrderPersonId!='' and makeOrderPersonId!=-1">
			AND y.id='${identifier}'
		</if>
		<if test="checkPersonId!=null and checkPersonId!='' and checkPersonId!=-1">
			AND rew.id='${checkPersonId}'
		</if>
	</sql>
	<select id="reportProcureFinishOrderPayMoneyDetail" resultMap="BaseResultMap">
	SELECT
		pt.parent_id,
		pt.id,
		pt.order_type,
		pt.identifier,
		s.`name` sName,
		pt.generate_date,
		(SELECT SUM(arrival_quantity*business_unit_price) FROM procure_commodity WHERE procure_table_id=pc.procure_table_id  GROUP BY procure_table_id ) total_tax_price,
		(SELECT SUM(arrival_quantity*business_unit_price*(1+tax_rate)) FROM procure_commodity WHERE procure_table_id=pc.procure_table_id  GROUP BY procure_table_id) totalPrice,
		pt.orderer,
		pt.phone,
		dk.`name` departmentName,
		st.`name` stName,
		sm.`name` smName,
		SUM(pc.discount) discount,
		pt.goods_arrival_place,
		pt.fax,
		r.`name` reviewer,
		pt.summary,
		k.`name` originator,
		pt.summary,
		pt.deliveryman,
			IFNULL(
		(
		SELECT
			SUM( bs.the_moeny ) 
		FROM
			bills b
			LEFT JOIN bills_sub bs ON b.id = bs.bills_id
		WHERE
			b.bills_type=2
			AND bs.procure_sales_id = pt.id 
		GROUP BY
			bs.procure_sales_id 
		),
		0 
	)+ IFNULL(
		(
		SELECT
			sum( ws.the_money ) 
		FROM
			writeoff w
			LEFT JOIN writeoff_sub ws ON w.id = ws.writeoff_id 
		WHERE
			w.type IN ( 1, 2, 5, 6 ) 
			AND ws.is_procure_sales = 2 
			AND ws.procure_sales_id = pt.id 
		GROUP BY
			ws.procure_sales_id 
		),
		0 
	) returnMoney
	FROM
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		LEFT JOIN settlement_type st ON st.id=pt.pay_type
		LEFT JOIN shipping_mode sm  ON sm.id=pt.transportation_mode
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id  and  u.basic_unit=1
		LEFT JOIN classification cla ON cla.id=s.classification_id
		LEFT JOIN person k ON k.identifier=pt.originator
		LEFT JOIN person r ON r.identifier=pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id
		LEFT JOIN department dk ON dk.id = k.department_id
		LEFT JOIN department dr ON dr.id= r.department_id
		WHERE 
	pt.state = 13 and pt.plan_or_order = 4 and pt.is_delete=0
	<!--单号  -->
		<if test="identifier!=null and identifier!=''">
			AND pt.identifier like '%${identifier}%'
		</if>
		<!--运输方式  -->
		<if test="shippingModel!=null and shippingModel!='' and shippingModel!=-1">
			AND pt.transportation_mode='${shippingModel}'
		</if>
		
		<!--客户名称分类  -->
		<if test="supctoTypeClassId!=null and supctoTypeClassId!='' and supctoTypeClassId!=-1">
			AND cla.parent_id='${supctoTypeClassId}'
		</if>
		<!--客户名称一级分类  -->
		<if test="supctoTypeClassTwoId!=null and supctoTypeClassTwoId!='' and supctoTypeClassTwoId!=-1">
			AND s.classification_id='${supctoTypeClassTwoId}'
		</if>
		<!--客户名称  -->
		<if test="supctoName!=null and supctoName!=''">
			AND s.name  like '%${supctoName}%'
		</if>
 
		<!--商品名称  -->
		<if test="cname!=null and cname!=''">
			AND c.name like '%${cname}%'
		</if>
		<!-- 商品编码 -->
		<if test="commodity_identifier!=null and commodity_identifier!=''">
			AND cs.specification_identifier like '%${commodity_identifier}%'
		</if>
		<!--品牌  -->
		<if test="brand!=null and brand!=''">
			AND c.brand like '%${brand}%'
		</if>
		<!--开单部门  -->
		<if test="departmentClassOneId!=null and departmentClassOneId!='' and departmentClassOneId!='-1'">
			AND dk.id='${departmentClassOneId}'
		</if>
		<!--开单人  -->
		<if test="makeOrderPersonId!=null and makeOrderPersonId!='' and makeOrderPersonId!='-1'">
			AND pt.originator='${makeIdentifier}'
		</if>
		<!--审核部门  -->
			<!--审核部门  -->
		<if test="checkDepartmentId!=null and checkDepartmentId!='' and checkDepartmentId!='-1'">
			AND dr.id='${checkDepartmentId}'
		</if>
		<!--审核人  -->
		<if test="checkPersonId!=null and checkPersonId!='' and checkPersonId!=-1">
			AND pt.reviewer='${rewviewIdentifier}'
		</if>
		<!--时间  -->
		<if test="beginTime!=null and beginTime!=''">
			AND
			pt.generate_date
			BETWEEN
			'${beginTime}'
			AND
			DATE_ADD('${closeTime}',INTERVAL 1 DAY)
		</if>
		
		<!--仓库  -->
		<if test="warehouseMsgId!=null and warehouseMsgId!='' and warehouseMsgId!=-1">
			AND i.warehouse_id='${warehouseMsgId}'
		</if>

	GROUP BY pt.id
	order by pt.id DESC
	</select>

	<!--应付账款汇总表 sql第一部分  -->
	<select id="reportPayMoneyGetherOne" resultMap="BaseResultMap">
	<!-- SELECT 
		s.id sId,
		pt.id,
		SUM(pt.prepaid_amount) prepaid_amount,
		SUM(pc.total_tax_price) total_tax_price,
		SUM(pc.original_unit_price*pc.arrival_quantity-pc.business_unit_price*pc.arrival_quantity) total_price,
		s.identifier sIdentifier,
		s.`name` sName
	FROM 
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id 
		LEFT JOIN classification cla ON cla.id=s.classification_id
		LEFT JOIN person k ON k.operator_identifier=pt.originator
		LEFT JOIN person r ON r.operator_identifier=pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id
	WHERE pt.state = 13 and pt.plan_or_order = 4 
	<include refid="query_where_base" />
	GROUP BY s.id order by pt.id DESC  -->
	
	</select>

	<!-- 采购退货的 金额 -->
	<select id="reportPayMoneyGetherTwo" resultMap="BaseResultMap">
	SELECT 
		s.id sId,
		SUM(pc.total_price) prepaid_amount
	
	FROM 
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id 
		LEFT JOIN classification cla ON cla.id=s.classification_id
		LEFT JOIN person k ON k.identifier=pt.originator
		LEFT JOIN person r ON r.identifier=pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id
	WHERE  pt.plan_or_order = 5  AND pt.state IN(3,14) and pt.is_delete=0
	<include refid="query_where_base" />
	GROUP BY s.id
	order by pt.id DESC 
	</select>

	<!--初期应付款  -->
	<select id="reportPayMoneyGetherThree" resultMap="BaseResultMap">
	SELECT 
	
		s.id sId,
		SUM(pt.prepaid_amount) prepaid_amount
	FROM 
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id 
		LEFT JOIN classification cla ON cla.id=s.classification_id
		LEFT JOIN person k ON k.identifier=pt.originator
		LEFT JOIN person r ON r.identifier=pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id
	WHERE pt.state = 13 and pt.plan_or_order = 4 and pt.generate_date LIKE '%${beginTime}%'
	and pt.is_delete=0
	GROUP BY s.id order by pt.id DESC 
	</select>

	<!--账面库存汇总表  -->
	<select id="reportAccountsGetherOne" resultMap="BaseResultMap">
	
	
	
	</select>

	<select id="reportAccountsGetherTwo" resultMap="BaseResultMap">
	SELECT
		cs.id id,
		cs.specification_identifier specification_identifier,
		pc.business_unit_price unitPrice,
		i.inventory inventoryNum, 
		pc.total_tax_price totalPrice
	FROM
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id 
		LEFT JOIN classification cla ON cla.id=s.classification_id
		LEFT JOIN person k ON k.identifier=pt.originator
		LEFT JOIN person r ON r.identifier=pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id
	WHERE 1=1 AND pt.plan_or_order=3  and pt.generate_date LIKE '%${beginTime}%' and pt.is_delete=0
	GROUP BY cs.id
	
	</select>
	
	<select id="reportOtherReceiveOrder" resultMap="BaseResultMap">
		SELECT
		 pt.id,
		 pt.identifier,
		 cs.specification_identifier,
		 cs.specification_name,
		 i.occupied_inventory,
		 c.`name` cName,
		 c.brand,
		 pt.generate_date,
		 u.`name` baseUnitName,
		 pc.order_num,
		 pc.business_unit_price,
		 pc.total_tax_price,
		 pc.remarks,
		 pc.lot_number
	FROM
		procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id 
		LEFT JOIN classification cla ON cla.id=s.classification_id
		LEFT JOIN person k ON k.identifier=pt.originator
		LEFT JOIN person r ON r.identifier=pt.reviewer
		LEFT JOIN inventory i ON i.specification_id=cs.id
		LEFT JOIN department dk ON dk.id=k.department_id
		LEFT JOIN department dr ON dr.id=r.department_id
	WHERE
		1 = 1 
		AND pt.plan_or_order = 6 and pt.is_delete=0
		<!--单号  -->
		<if test="identifier!=null and identifier!=''">
			AND pt.identifier like '%${identifier}%'
		</if>
		<!--运输方式  -->
		<if test="shippingModel!=null and shippingModel!='' and shippingModel!=-1">
			AND pt.transportation_mode='${shippingModel}'
		</if>
		
		
 
		<!--商品名称  -->
		<if test="cname!=null and cname!=''">
			AND c.name like '%${cname}%'
		</if>
		<!-- 商品编码 -->
		<if test="commodity_identifier!=null and commodity_identifier!=''">
			AND cs.specification_identifier like '%${commodity_identifier}%'
		</if>
		<!--品牌  -->
		<if test="brand!=null and brand!=''">
			AND c.brand like '%${brand}%'
		</if>
		<!--开单部门  -->
		<if test="departmentClassOneId!=null and departmentClassOneId!='' and departmentClassOneId!='-1'">
			AND pt.department_id='${departmentClassOneId}'
		</if>
		<!--开单人  -->
		<if test="makeOrderPersonId!=null and makeOrderPersonId!='' and makeOrderPersonId!='-1'">
			AND pt.originator='${makeIdentifier}'
		</if>
		<!--审核部门  -->
			<!--审核部门  -->
		<if test="checkDepartmentId!=null and checkDepartmentId!='' and checkDepartmentId!='-1'">
			AND dr.id='${checkDepartmentId}'
		</if>
		
		<!--审核人  -->
		<if test="checkPersonId!=null and checkPersonId!='' and checkPersonId!=-1">
			AND pt.reviewer='${rewviewIdentifier}'
		</if>
		<!--时间  -->
		<if test="beginTime!=null and beginTime!=''">
			AND
			pt.generate_date
			BETWEEN
			'${beginTime}'
			AND
			DATE_ADD('${closeTime}',INTERVAL 1 DAY)
		</if>
		
		<!--仓库  -->
		<if test="warehouseMsgId!=null and warehouseMsgId!='' and warehouseMsgId!=-1">
			AND i.warehouse_id='${warehouseMsgId}'
		</if>
	
		<!-- 待审核 -->
		<if test="state==1 and state!=-1">
			AND pt.state in(8,16,18)
		</if>
		<!-- 已审核 -->
		<if test="state==2 and state!=-1">
			AND pt.state IN (9,10,17,19,20)
		</if>
		<!-- 已入库 -->
		<if test="state==3 and state!=-1">
			AND pt.state=100
		</if>
		<!-- 已出库 -->
		<if test="state==4 and state!=-1">
			AND pt.state=100
		</if>
		<!-- 已开单 -->
		<if test="state==5 and state!=-1">
			AND pt.state=13
		</if>
		<!-- 已终止 -->
		<if test="state==6 and state!=-1">
			AND pt.state=9
		</if>
		<!-- 其他 -->
		<if test="state==7 and state!=-1">
			AND pt.state not IN (8,9,10,13,16,17,18,19,20)
		</if>
	
		
		GROUP BY
		pc.id
		ORDER BY
			id DESC
		</select>
	<!--表报查询条件  供查询采购退货出库单的查询使用  -->
	<sql id="query_where_base_no_checkperson">
	  	<!--单号  -->
		<if test="identifier!=null and identifier!=''">
			AND pt.identifier like '%${identifier}%'
		</if>
		<!--运输方式  -->
		<if test="shippingModel!=null and shippingModel!='' and shippingModel!=-1">
			AND pt.transportation_mode='${shippingModel}'
		</if>
		
		<!--客户名称分类  -->
		<if test="supctoTypeClassId!=null and supctoTypeClassId!='' and supctoTypeClassId!=-1">		
			AND cla.parent_id='${supctoTypeClassId}'
		</if>
		<!--客户名称二级分类  -->
		<if test="supctoTypeClassTwoId!=null and supctoTypeClassTwoId!='' and supctoTypeClassTwoId!=-1">
			AND s.classification_id='${supctoTypeClassTwoId}'
		</if>
		<!--客户名称  -->
		<if test="supctoName!=null and supctoName!=''">
			AND s.name  like '%${supctoName}%'
		</if>
		<!--商品名称  -->
		<if test="cname!=null and cname!=''">
			AND c.name like '%${cname}%'
		</if>
		<!-- 商品编码 -->
		<if test="commodity_identifier!=null and commodity_identifier!=''">
			AND cs.specification_identifier like '%${commodity_identifier}%'
		</if>
		<!--品牌  -->
		<if test="brand!=null and brand!=''">
			AND c.brand like '%${brand}%'
		</if>
		<!--开单部门  -->
		<if test="departmentClassOneId!=null and departmentClassOneId!='' and departmentClassOneId!='-1'">
			AND dk.id='${departmentClassOneId}'
		</if>
		<!--开单人  -->
		<if test="makeOrderPersonId!=null and makeOrderPersonId!='' and makeOrderPersonId!='-1'">
			AND k.identifier='${makeIdentifier}'
		</if>
		<!--时间  -->
		<if test="beginTime!=null and beginTime!=''">
			AND
			pt.generate_date
			BETWEEN
			'${beginTime}'
			AND
			DATE_ADD('${closeTime}',INTERVAL 1 DAY)
		</if>
		
		<!--仓库  -->
		<if test="warehouseMsgId!=null and warehouseMsgId!='' and warehouseMsgId!=-1">
			AND i.warehouse_id='${warehouseMsgId}'
		</if>
	</sql>

	<!-- 查询采购退货出库明细，供出库单报表使用 -->
	<select id="getSaleReturnDetailToReport" resultMap="BaseResultMap">
		SELECT
			pt.identifier,
			pt.plan_or_order,
			pt.generate_date,
			cs.specification_identifier,
			cs.specification_name,
			i.occupied_inventory,
			c.name cName,
			u.name baseUnitName,
			s.name sName,
			c.brand,
			pc.business_unit_price,
			pc.arrival_quantity,
			pc.total_price,
			pc.remarks,
			pc.lot_number,
			c.identifier cIdentifier,
			w.name wName
		FROM
			procure_commodity pc
		LEFT JOIN procure_table pt ON pt.id = pc.procure_table_id
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		LEFT JOIN unit u ON u.specification_id = cs.id
		AND u.basic_unit = 1
		LEFT JOIN classification cla ON cla.id = s.classification_id
		LEFT JOIN person k ON k.identifier = pt.originator
		LEFT JOIN person r ON r.id = pt.reviewer
		LEFT JOIN inventory i ON i.specification_id = cs.id
		LEFT JOIN warehouse w ON w.id = i.warehouse_id
		LEFT JOIN department dk ON k.department_id = dk.id
		LEFT JOIN department dr ON r.department_id = dr.id
		where pt.plan_or_order=5 
		and pt.state=14 
		<include refid="query_where_base_no_checkperson" />
		ORDER BY pt.id
	
	</select>
	
	<!-- 查询采购退货出库汇总，供出库单报表使用 -->
	<select id="getSaleReturnAllMsgToReport" resultMap="BaseResultMap">
		SELECT
			pt.identifier,
			pt.plan_or_order,
			pt.generate_date,
			sum(i.occupied_inventory) occupied_inventory,
			cs.specification_identifier,
			cs.specification_name,
			c.name cName,
			u.name baseUnitName,
			s.name sName,
			c.brand,
			pc.business_unit_price,
			pc.commodity_id,
			SUM(pc.arrival_quantity) arrival_quantity,
			SUM(pc.total_price) total_price,
			pc.remarks,
			pc.lot_number,
			c.identifier cIdentifier,
			w.name specWarehouseName
		FROM
			procure_commodity pc
		LEFT JOIN procure_table pt ON pt.id = pc.procure_table_id
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id
		LEFT JOIN unit u ON u.specification_id = cs.id
		AND u.basic_unit = 1
		LEFT JOIN classification cla ON cla.id = s.classification_id
		LEFT JOIN person k ON k.identifier = pt.originator
		LEFT JOIN person r ON r.id = pt.reviewer
		LEFT JOIN inventory i ON i.specification_id = cs.id
		LEFT JOIN warehouse w ON w.id = i.warehouse_id
		LEFT JOIN department dk ON k.department_id = dk.id
		LEFT JOIN department dr ON r.department_id = dr.id
		where pt.plan_or_order=5 
		and pt.state=14
		<include refid="query_where_base_no_checkperson" />
		GROUP BY pc.commodity_id
		ORDER BY pt.id
	</select>
	
	<select id="reportProcureReturnOrderDetail"  resultMap="BaseResultMap">
		SELECT
			pc.total_price,
			pt.id,
			pt.identifier,
			pt.generate_date,
			cs.specification_identifier,
			cs.specification_name,
			
			c.`name` cName,
			u.NAME baseUnitName,
			pc.business_unit_price,
			pc.arrival_quantity,
			IFNULL(pc.remarks,"") remarks ,
			
			IFNULL(pc.discount,"") discount,
			i.occupied_inventory,
			
			s.identifier,
			s.`name` sName,
			
			IFNULL(pc.tax_rate,0) tax_rate,
			dk.`name` departmentName,
			IFNULL(st.`name`,"")  stName,
			sm.`name` smName,
			IFNULL(pt.orderer,"") orderer,
			pt.phone,
			pt.goods_arrival_place,
			pt.fax,
			<if test="type2==1">
			IFNULL(
		(
		SELECT
			SUM( bs.the_moeny ) 
		FROM
			bills b
			LEFT JOIN bills_sub bs ON b.id = bs.bills_id
		WHERE
			b.bills_type=2
			AND bs.procure_sales_id = pt.id 
		GROUP BY
			bs.procure_sales_id 
		),
		0 
	)+IFNULL((SELECT
	
	sum(ws.the_money)
	
FROM
	writeoff w
	LEFT JOIN writeoff_sub ws ON w.id=ws.writeoff_id
	
WHERE
	w.type IN(1,2,5,6)  
	AND ws.is_procure_sales=2
	AND ws.procure_sales_id=pt.id
GROUP BY
ws.procure_sales_id),0) returnMoney ,
	sum(pc.arrival_quantity*pc.business_unit_price) arrival_money,
			</if>
			r.`name` reviewer,
			k.`name` originator
			
			
		FROM
			procure_table pt
		LEFT JOIN procure_commodity pc ON pt.id = pc.procure_table_id
		LEFT JOIN supcto s ON s.id = pt.supcto_id 
		LEFT JOIN commodity_specification cs ON cs.id = pc.commodity_id
		LEFT JOIN commodity c ON c.id = cs.commodity_id
		LEFT JOIN unit u ON u.specification_id = cs.id
		LEFT JOIN classification cla ON cla.id = s.classification_id
		LEFT JOIN person k ON k.identifier = pt.originator
		LEFT JOIN person r ON r.identifier = pt.reviewer
		LEFT JOIN inventory i ON i.specification_id = cs.id 
		LEFT JOIN settlement_type st ON st.id = pt.pay_type
		LEFT JOIN shipping_mode sm ON sm.id = pt.transportation_mode
		LEFT JOIN department dk ON dk.id = k.department_id
		LEFT JOIN department dr ON dr.id = r.department_id 
		WHERE
			1 = 1 
			
			AND pt.is_delete = 0 
			AND pt.plan_or_order = 5 
			<include refid="query_where_base" />
			
			<if test="type2==1">
			GROUP BY
			pt.id
			</if>
			<if test="type2==2">
			GROUP BY
			pc.id
			</if>
		
		
	</select>
</mapper>